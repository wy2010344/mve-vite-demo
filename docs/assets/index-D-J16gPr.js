import{c as A,w as K,j as D,b as z,aq as ee,l as te,f as W,J as se,x as oe,ar as ne,z as re,e as j,d as F,g as ae,as as U,v as P,U as H,E as ie,at as I,au as ce,m as de,p as ge,t as le}from"./index-D84f0y8o.js";import fe from"./graph-BB3NgaJ2.js";import{o as ue}from"./transform-W4V8p7Sk.js";import{f as he,a as pe,b as E,i as me,m as ye,c as ve,t as xe,e as we,d as ke}from"./forceLayout-B04iL2ON.js";import{g as be,r as Se,T as Te,h as De}from"./hookThreeView-DAxFxKJt.js";import{b as ze}from"./index-BQKsZa9b.js";import{c as Le}from"./category10-CXXk8p4X.js";import{C as Ce,A as Me,D as J,S as Ae,R as Fe,V as Be,M as _e,a as Ne,L as Re,b as Z,B as Xe,c as Ye,d as Pe,e as Ee}from"./three.core-Bu5rU7E4.js";import"./three.module-b3oiPfzz.js";import"./index-GzwYIlJs.js";import"./iconBase-B9IP-JiR.js";import"./index-BHzW6WMu.js";const k=800,b=800,Oe=.001,$e=["2D-svg","2D-canvas","3D"];function tt(){const L=A("2D-canvas");ze({options:$e,value:L.get,onChange:L.set,renderChild(h){oe.span().renderTextContent(h)}});const m=A(fe),x=ue(Le),S=he(),w=pe(),y=E("x"),B=E("y");function _(h,l){const f=ne(me()),p=()=>f.alpha<Oe,g=re(t=>ye({nodes:(t==null?void 0:t.nodes)||j,links:(t==null?void 0:t.links)||j,fromLinks:m.get().links,fromNodes:m.get().nodes,createForceNode(s,a,c){return ve(s,h,a,ke,we)},getNodeKey(s){return s.id},getSorceKey(s){return s.source},getTargetKey(s){return s.target},createFromKey(s){return{id:s,group:"not-found"}}}));function e(){const t=g();xe(h,f,t.nodes,s=>{S(t.links,h,s),w(t.nodes,h,s),l(t,s)})}return F(p,function(t){if(!t)return ae(()=>{e()})}),{config:f,getNodesAndLinks:g,didTick:e}}K(L.get,function(h){if(h=="2D-svg"){const{getNodesAndLinks:l,didTick:f,config:p}=_(2,(e,t)=>{y(e.nodes,t),B(e.nodes,t)}),g=D.svg({width:k,height:b,viewBox:`${-800/2} ${-800/2} ${k} ${b}`,s_maxWidth:"100%",s_height:"auto",children(){z(()=>l().links,e=>D.g({stroke:"#999",strokeOpacity:.6,children(){D.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:Math.sqrt(e.value.value)})}})),z(()=>l().nodes,e=>D.g({stroke:"#fff",strokeWidth:1.5,children(){D.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,fill:x(e.value.group),...ee(t=>{const s=g.getBoundingClientRect(),a=s.left+s.width/2,c=s.top+s.height/2;e.x.f=t.pageX-a,e.y.f=t.pageY-c,p.alphaTarget=.3,f();const u=U(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,p.alphaTarget=0,u())})})})}}))}})}else if(h=="2D-canvas"){const{getNodesAndLinks:l,didTick:f,config:p}=_(2,(g,e)=>{y(g.nodes,e),B(g.nodes,e)});te(W.canvas({s_width:k+"px",s_height:b+"px"}),function(g){de({x:0,y:0,draw({ctx:e}){e.strokeStyle="#999",l().links.forEach(t=>{e.beginPath(),e.moveTo(t.source.x.d,t.source.y.d),e.lineTo(t.target.x.d,t.target.y.d),e.lineWidth=Math.sqrt(t.value.value),e.stroke()})}}),z(()=>l().nodes,function(e){ge({x:e.x.dSignal.get,y:e.y.dSignal.get,width:0,height:0,draw({ctx:t,path:s}){s.ellipse(0,0,5,5,0,0,360),le(x(e.value.group))},onPointerDown({original:t}){console.log("click");const s=g.canvas.getBoundingClientRect(),a=s.left+s.width/2,c=s.top+s.height/2;e.x.f=t.pageX-a,e.y.f=t.pageY-c,p.alphaTarget=.3,f();const u=U(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,p.alphaTarget=0,u())})}})})},{beforeDraw(g){g.translate(k/2,b/2)}})}else if(h=="3D"){const l=A(void 0),f=A(void 0);K(l.get,function(a){if(!a)return;const c=a.userData;W.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){var u;return(((u=f.get())==null?void 0:u.clientX)||0)+15+"px"},s_top(){var u;return(((u=f.get())==null?void 0:u.clientY)||0)+15+"px"},children(){se`${c.value.group}--${c.value.citing_patents_count||""}`}})});const p=E("z"),{getNodesAndLinks:g,didTick:e,config:t}=_(3,(a,c)=>{y(a.nodes,c),B(a.nodes,c),p(a.nodes,c)}),s=be(k,b);s.position.z=500,Se({camera:s,width:k,height:b,render(a){const{renderer:c}=Te.consume();a.background=new Ce(16119802);const u=new Me(16777215,.4);a.add(u);const d=new J(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,a.add(d);const O=new J(16777215,.3);O.position.set(-5,5,5),a.add(O);const $=De(),Q=new Ae(5,32,32);function N(n,i){n.x=i.x.d,n.y=i.y.d,n.z=i.z.d}const T=new Fe,C=new Be,R=[],M=c.domElement;function q(n,i,o){const r=i.clientX-o.left,v=i.clientY-o.top;n.x=r/o.width*2-1,n.y=-(v/o.height*2-1)}function G(n,i){q(C,n,i),T.setFromCamera(C,s);const o=T.intersectObjects(R);if(o.length>0)return o[0].object}P(H(M,"pointermove",n=>{const i=M.getBoundingClientRect(),o=G(n,i);o?(l.set(o),f.set(n)):l.set(void 0)})),P(H(M,"pointerdown",n=>{const i=M.getBoundingClientRect(),o=G(n,i);if(o){$.enabled=!1;const r=o.userData;r.z.f=r.z.d,t.alphaTarget=.3,e(),ie({onMove(v){q(C,v,i),T.setFromCamera(C,s);const X=T.ray.direction,Y=T.ray.origin,V=(r.z.f-Y.z)/X.z;r.x.f=Y.x+X.x*V,r.y.f=Y.y+X.y*V},onEnd(v){r.x.f=void 0,r.y.f=void 0,t.alphaTarget=0,$.enabled=!0}})}})),z(()=>g().nodes,n=>{const i=x(n.value.group),o=new _e({color:i,specular:1118481,shininess:50,bumpMap:qe(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Ne(Q,o);I(r),r.userData=n,R.push(r),P(()=>{ce(R,r)}),F(()=>{l.get()==r?o.emissive.setHex(3355443):o.emissive.set(i)}),F(()=>{N(r.position,n)})}),z(()=>g().links,n=>{const i=new Re({color:0,transparent:!0,opacity:.3}),o=[];o.push(new Z),o.push(new Z);const r=new Xe().setFromPoints(o),v=new Ye(r,i);I(v),F(()=>{N(o[0],n.source),N(o[1],n.target),v.geometry=r.setFromPoints(o)})})}})}})}function qe(){const m=new Uint8Array(16384);for(let S=0;S<64*64;S++){const w=S*4,y=Math.random()*255;m[w]=y,m[w+1]=y,m[w+2]=y,m[w+3]=255}const x=new Pe(m,64,64,Ee);return x.needsUpdate=!0,x}export{tt as default};
