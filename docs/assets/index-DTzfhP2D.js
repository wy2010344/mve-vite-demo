import{c as A,w as K,j as D,b as z,aq as ee,l as te,f as W,J as se,x as oe,ar as ne,z as re,e as j,d as F,g as ae,as as U,v as $,U as H,E as ie,at as I,au as ce,m as de,p as ge,t as le}from"./index-BNMIKCZr.js";import fe from"./graph-BB3NgaJ2.js";import{o as ue}from"./transform-a71IrbW-.js";import{f as he,a as pe,b as P,i as me,m as ye,c as ve,t as xe,e as we,d as be}from"./forceLayout-f7xtq5qb.js";import{g as ke,r as Se,T as Te,h as De}from"./hookThreeView-DIRruv18.js";import{b as ze}from"./index-CvwBNoCX.js";import{c as Le}from"./category10-W348WWuH.js";import{C as Ce,A as Me,D as J,S as Ae,R as Fe,V as Be,M as _e,a as Ne,L as Re,b as Z,B as Xe,c as Ye,d as $e,e as Pe}from"./three.core-mdAJ0X3w.js";import"./three.module-LbcCID0H.js";import"./index-Cu7z6rlk.js";import"./iconBase-DlBHF_7I.js";import"./index-BxY9dVzG.js";const v=800,x=800,Ee=.001,Oe=["2D-svg","2D-canvas","3D"];function tt(){const L=A("2D-canvas");ze({options:Oe,value:L.get,onChange:L.set,renderChild(u){oe.span().renderTextContent(u)}});const p=A(fe),w=ue(Le),k=he(),b=pe(),m=P("x"),B=P("y");function _(u,l){const f=ne(me()),h=()=>f.alpha<Ee,g=re(s=>ye({nodes:s?.nodes||j,links:s?.links||j,fromLinks:p.get().links,fromNodes:p.get().nodes,createForceNode(t,a,c){return ve(t,u,a,be,we)},getNodeKey(t){return t.id},getSorceKey(t){return t.source},getTargetKey(t){return t.target},createFromKey(t){return{id:t,group:"not-found"}}}));function e(){const s=g();xe(u,f,s.nodes,t=>{k(s.links,u,t),b(s.nodes,u,t),l(s,t)})}return F(h,function(s){if(!s)return ae(()=>{e()})}),{config:f,getNodesAndLinks:g,didTick:e}}K(L.get,function(u){if(u=="2D-svg"){const{getNodesAndLinks:l,didTick:f,config:h}=_(2,(e,s)=>{m(e.nodes,s),B(e.nodes,s)}),g=D.svg({width:v,height:x,viewBox:`${-v/2} ${-x/2} ${v} ${x}`,s_maxWidth:"100%",s_height:"auto",children(){z(()=>l().links,e=>D.g({stroke:"#999",strokeOpacity:.6,children(){D.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:Math.sqrt(e.value.value)})}})),z(()=>l().nodes,e=>D.g({stroke:"#fff",strokeWidth:1.5,children(){D.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,fill:w(e.value.group),...ee(s=>{const t=g.getBoundingClientRect(),a=t.left+t.width/2,c=t.top+t.height/2;e.x.f=s.pageX-a,e.y.f=s.pageY-c,h.alphaTarget=.3,f();const S=U(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,h.alphaTarget=0,S())})})})}}))}})}else if(u=="2D-canvas"){const{getNodesAndLinks:l,didTick:f,config:h}=_(2,(g,e)=>{m(g.nodes,e),B(g.nodes,e)});te(W.canvas({s_width:`${v}px`,s_height:`${x}px`}),function(g){de({x:0,y:0,draw({ctx:e}){e.strokeStyle="#999",l().links.forEach(s=>{e.beginPath(),e.moveTo(s.source.x.d,s.source.y.d),e.lineTo(s.target.x.d,s.target.y.d),e.lineWidth=Math.sqrt(s.value.value),e.stroke()})}}),z(()=>l().nodes,function(e){ge({x:e.x.dSignal.get,y:e.y.dSignal.get,width:0,height:0,draw({ctx:s,path:t}){t.ellipse(0,0,5,5,0,0,360),le(w(e.value.group))},onPointerDown({original:s}){const t=g.canvas.getBoundingClientRect(),a=t.left+t.width/2,c=t.top+t.height/2;e.x.f=s.pageX-a,e.y.f=s.pageY-c,h.alphaTarget=.3,f();const S=U(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,h.alphaTarget=0,S())})}})})},{beforeDraw(g){g.translate(v/2,x/2)}})}else if(u=="3D"){const l=A(void 0),f=A(void 0);K(l.get,function(a){if(!a)return;const c=a.userData;W.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){return`${(f.get()?.clientX||0)+15}px`},s_top(){return`${(f.get()?.clientY||0)+15}px`},children(){se`${c.value.group}--${c.value.citing_patents_count||""}`}})});const h=P("z"),{getNodesAndLinks:g,didTick:e,config:s}=_(3,(a,c)=>{m(a.nodes,c),B(a.nodes,c),h(a.nodes,c)}),t=ke(v,x);t.position.z=500,Se({camera:t,width:v,height:x,render(a){const{renderer:c}=Te.consume();a.background=new Ce(16119802);const S=new Me(16777215,.4);a.add(S);const d=new J(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,a.add(d);const E=new J(16777215,.3);E.position.set(-5,5,5),a.add(E);const O=De(),Q=new Ae(5,32,32);function N(n,i){n.x=i.x.d,n.y=i.y.d,n.z=i.z.d}const T=new Fe,C=new Be,R=[],M=c.domElement;function q(n,i,o){const r=i.clientX-o.left,y=i.clientY-o.top;n.x=r/o.width*2-1,n.y=-(y/o.height*2-1)}function G(n,i){q(C,n,i),T.setFromCamera(C,t);const o=T.intersectObjects(R);if(o.length>0)return o[0].object}$(H(M,"pointermove",n=>{const i=M.getBoundingClientRect(),o=G(n,i);o?(l.set(o),f.set(n)):l.set(void 0)})),$(H(M,"pointerdown",n=>{const i=M.getBoundingClientRect(),o=G(n,i);if(o){O.enabled=!1;const r=o.userData;r.z.f=r.z.d,s.alphaTarget=.3,e(),ie({onMove(y){q(C,y,i),T.setFromCamera(C,t);const X=T.ray.direction,Y=T.ray.origin,V=(r.z.f-Y.z)/X.z;r.x.f=Y.x+X.x*V,r.y.f=Y.y+X.y*V},onEnd(y){r.x.f=void 0,r.y.f=void 0,s.alphaTarget=0,O.enabled=!0}})}})),z(()=>g().nodes,n=>{const i=w(n.value.group),o=new _e({color:i,specular:1118481,shininess:50,bumpMap:qe(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Ne(Q,o);I(r),r.userData=n,R.push(r),$(()=>{ce(R,r)}),F(()=>{l.get()==r?o.emissive.setHex(3355443):o.emissive.set(i)}),F(()=>{N(r.position,n)})}),z(()=>g().links,n=>{const i=new Re({color:0,transparent:!0,opacity:.3}),o=[];o.push(new Z),o.push(new Z);const r=new Xe().setFromPoints(o),y=new Ye(r,i);I(y),F(()=>{N(o[0],n.source),N(o[1],n.target),y.geometry=r.setFromPoints(o)})})}})}})}function qe(){const p=new Uint8Array(16384);for(let k=0;k<4096;k++){const b=k*4,m=Math.random()*255;p[b]=m,p[b+1]=m,p[b+2]=m,p[b+3]=255}const w=new $e(p,64,64,Pe);return w.needsUpdate=!0,w}export{tt as default};
