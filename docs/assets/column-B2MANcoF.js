import{z as y,c as E,aO as p,aX as S,E as R,v as Y,aU as L,d as N}from"./index-BiAKiJb6.js";import P from"./columnBase-CZeMNCzH.js";import{ArrayRender as z}from"./xmlRender-Cf3-X-tL.js";import{taskContext as K}from"./context-0g6b5_50.js";import O from"./cardBase-C6a53hfm.js";import{p as U}from"./index-DQpQsvk_.js";import"./type-DRAuYFMP.js";import"./chunk-KZPPZA2C-rvBpA5M9.js";import"./index-DZxvByzS.js";import"./iconBase-CduQK-mk.js";import"./mve-icon-DCWotxJD.js";import"./index-C6eOwPKX.js";import"./index-BxY9dVzG.js";function nt({title:x,type:s}){const{tasks:f,dragData:a,dragX:h,dragY:m,columns:w,activeColumn:u,backHolder:B,targetHolder:I,dragTask:b}=K.consume();function k(t,{whenIntoTarget:n,whenIntoDraft:r,whenNotDist:e}){let o=t.target;for(;o;){for(const[i,l]of w)if(l==o){n(i);return}o=o.parentElement}e?.()}const d=y(function(){return f.get().filter(t=>{if(t.type!=s)return!1;const n=a.get();return!(n&&n.type.get()!="cancel"&&t.id==n.id)})}),v=new Map,D=E(0);let X;const C=y(()=>{if(!a.get()||u.get()!=s)return-1;const n=m.get(),r=X.getBoundingClientRect(),e=D.get();if(n<r.top||n>r.bottom)return-1;const o=d();for(let i=0;i<o.length;i++){const l=o[i],g=v.get(l.id);if(!g)throw"";const c=g.offsetTop+r.top-e;if(n<c+g.clientHeight/2)return i}return o.length}),M=y(()=>{const t=C();if(t<0)return d();const n=b();if(!n)return d();const r=[...d()];return r.splice(t,0,{...n,type:s}),r});return p.createElement(P,{type:s,title:x,tasks:f.original,getTasks:d,plugin:S(t=>{t.addEventListener("scroll",n=>{D.set(t.scrollTop)})},L({shouldMeasure(){return C()>-1},direction:"y",multi:3}),t=>{X=t,w.set(s,t),Y(()=>{w.delete(s)})})},p.createElement(z,{getArray:M,getKey:t=>t.id,render:(t,n,r)=>{p.renderChild(p.createElement(O,{plugin:S(U(n,"y"),e=>{v.set(r,e),Y(()=>{v.delete(r)}),N(()=>r==a.get()?.id&&u.get()==s,function(o){o&&I.set({type:s,element:e,getBeforeId(){return d()[C()]?.id}})}),a.get()?.type.get()=="cancel"&&B.set(e)}),selected:()=>a.get()?.id==r,onDelete:()=>{f.original.set(f.original.get().filter(e=>e.id!=r))},className:()=>a.get()?.id==r?"opacity-0":"",getTask:t,onPointerDown:e=>{if(a.get())return;const i=e.currentTarget.getBoundingClientRect();h.set(e.pageX),m.set(e.pageY);const l={width:i.width,height:i.height,x:e.pageX-i.x,y:e.pageY-i.y,id:r,type:E(void 0)};a.set(l);let g=e;document.body.style.userSelect="none",R({onMove(c){k(c,{whenIntoTarget(H){u.set(H)}});const T=c.pageX-g.pageX,A=c.pageY-g.pageY;h.set(h.get()+T),m.set(m.get()+A),g=c},onEnd(c){document.body.style.userSelect="",k(c,{whenIntoTarget(T){u.set(T),l.type.set("move")},whenNotDist(){u.set(void 0),l.type.set("cancel")}})}})}}))}}))}export{nt as default};
