import{j as B,i as M,y as D,bH as F,ap as T,z as G,o as H,c as L,f as W,bK as _}from"./index-SfgOm-p3.js";import{ColumnContext as A,TaskContext as E}from"./context-BJkkMrcv.js";import{z as e}from"./index-PeN622_I.js";import{r as h}from"./mve-icon-DNZaWk48.js";import{G as x}from"./iconBase-BQ1OgeWz.js";import{priorityTypes as z}from"./type-DRAuYFMP.js";import{f as p}from"./chunk-KZPPZA2C-rvBpA5M9.js";import"./canvasRender-DwJvwbpB-BWU3cVJm.js";import"./_commonjsHelpers-CqkleIqs.js";function N(t,n){return x(N,{attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 2v4"},child:[]},{tag:"path",attr:{d:"M16 2v4"},child:[]},{tag:"rect",attr:{width:"18",height:"18",x:"3",y:"4",rx:"2"},child:[]},{tag:"path",attr:{d:"M3 10h18"},child:[]}]},t,n)}N.iconName="calendar";function w(t,n){return x(w,{attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12h14"},child:[]},{tag:"path",attr:{d:"M12 5v14"},child:[]}]},t,n)}w.iconName="plus";function C(t,n){return x(C,{attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"},child:[]}]},t,n)}C.iconName="user";function I(t,n){return x(I,{attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 6 6 18"},child:[]},{tag:"path",attr:{d:"m6 6 12 12"},child:[]}]},t,n)}I.iconName="x";function y({condition:t,whenTrue:n,whenFalse:a}){B(t,n,a)}function v({render:t}){t()}function K({getArray:t,getKey:n,render:a}){M(t,n,a)}function j({getBeforeId:t=()=>""}){const{type:n,getActive:a}=A.consume();return e.createElement("div",{className:function(){return D("my-0.5 h-0.5 w-full bg-violet-400",a()==t()?"opacity-100":"opacity-0")},data_before:t,data_column:n})}const O={low:"daisy-badge-success",medium:"daisy-badge-warning",high:"daisy-badge-error"},P={low:"低",medium:"中",high:"高"};function R({getTask:t,selected:n=T,onDelete:a=G,...r}){return e.createElement("div",{...r,className:function(){return D("daisy-card bg-base-100 shadow-md hover:shadow-lg cursor-move transition-shadow group",n()&&"bg-gray-400",F(r.className))}},e.createElement("div",{className:"daisy-card-body p-4"},e.createElement("div",{className:"flex items-start justify-between mb-2"},e.createElement("h4",{className:"daisy-card-title text-sm leading-tight"},()=>t().title),e.createElement("button",{className:"daisy-btn daisy-btn-ghost daisy-btn-xs opacity-0 group-hover:opacity-100 transition-opacity",onClick:o=>a(t().id),onPointerDown:o=>o.stopPropagation()},e.createElement(v,{render:()=>{I(h,"12px")}}))),e.createElement(y,{condition:()=>t().description,whenTrue:()=>{e.renderChild(e.createElement("p",{className:"text-xs text-base-content/70 mb-3 line-clamp-2"},()=>t().description))}}),e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:()=>`daisy-badge daisy-badge-sm ${O[t().priority]}`},()=>P[t().priority]),e.createElement("div",{className:"flex items-center gap-2 text-xs text-base-content/60"},e.createElement(y,{condition:()=>t().assignee,whenTrue:()=>{e.renderChild(e.createElement("div",{className:"flex items-center gap-1"},e.createElement(v,{render:()=>{C(h,"12px")}}),e.createElement("span",null,()=>t().assignee)))}}),e.createElement(y,{condition:()=>t().dueDate,whenTrue:()=>{e.renderChild(e.createElement("div",{className:"flex items-center gap-1"},e.createElement(v,{render:()=>{N(h,"12px")}}),e.createElement("span",null,()=>t().dueDate)))}})))))}function Y({getTask:t,onDelete:n,onDragStart:a}){const{dragId:r}=E.consume();e.renderChild(e.createElement(e.Fragment,null,e.createElement(j,{getBeforeId:()=>t().id}),e.createElement(R,{selected:()=>r.get()==t().id,draggable:!0,onDragStart:a,onDragEnd:o=>{console.log("dragEnd",o.currentTarget),r.set(void 0)},onDelete:n,getTask:t})))}function $({title:t,tasks:n,type:a,getTasks:r,children:o,...l}){return e.createElement("div",{className:"daisy-card bg-base-200 w-80 shrink-0 h-full"},e.createElement("div",{className:"daisy-card-body p-4 flex flex-col h-full "},e.createElement("div",{className:"flex items-center justify-between mb-4"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("h3",{className:"daisy-card-title text-sm font-medium"},t),e.createElement("div",{className:"daisy-badge daisy-badge-neutral daisy-badge-sm"},()=>r().length)),e.createElement("button",{className:"daisy-btn daisy-btn-ghost daisy-btn-sm daisy-btn-circle",onClick:()=>{n.set(n.get().concat({type:a,id:`${Date.now()}`,title:p.book.title(),description:p.book.series(),priority:z[p.number.int({min:0,max:2})],assignee:p.book.author(),dueDate:"2024-01-15"}))}},e.createElement(v,{render:()=>{w(h,"24px")}}))),e.createElement("div",{className:"space-y-3 min-h-[200px] flex-1 overflow-y-auto -mx-4 px-4 relative",...l},o,e.createElement(y,{condition:()=>!r().length,whenTrue:()=>{e.renderChild(e.createElement("div",{className:"text-center text-base-content/50 text-sm py-8"},"拖拽任务到这里或点击 + 添加新任务"))}}))))}function V({title:t,type:n}){const{dragId:a,tasks:r}=E.consume(),o=H(function(){return r.get().filter(i=>i.type==n&&i.id!=a.get())}),l=L(void 0);A.provide({type:n,getActive:l.get});function k(i){const m=Array.from(document.querySelectorAll(`[data-column="${n}"]`)),s=100,c=m.reduce((d,g)=>{const S=g.getBoundingClientRect(),b=i-(S.top+s/2);return b<0&&b>d.offset?{offset:b,element:g}:d},{offset:Number.NEGATIVE_INFINITY,element:m.at(-1)}).element?.dataset.before;return l.get()!=c&&l.set(c),c}return e.createElement($,{type:n,title:t,tasks:r,getTasks:o,onDragOver:i=>{i.preventDefault(),i.dataTransfer.dropEffect="move",k(i.clientY)},onDragLeave:i=>{l.set(void 0)},onDrop:i=>{const m=k(i.clientY),s=a.get();if(m!=s){const u=r.get().find(d=>d.id==s),c=u.type==n?u:{...u,type:n},f=r.get().filter(d=>d.id!=s);if(m=="")f.push(c);else{const d=f.findIndex(g=>g.id==m);f.splice(d,0,c)}r.set(f)}l.set(void 0)}},e.createElement(K,{getArray:o,getKey:i=>i.id,render:function(i,m,s){Y({getTask:i,onDelete(u){r.set(r.get().filter(c=>c.id!=s))},onDragStart(u){a.set(s)}})}}),e.createElement(j,null))}function re({tasks:t,columns:n}){W.div({className:"flex gap-6 overflow-x-auto overflow-y-hidden pb-6 flex-1 relative",children(){const a=L(void 0);E.provide({dragId:a,tasks:t}),n.map(r=>{_(()=>{e.renderChild(V(r))})})}})}export{re as default};
