import{ay as P,az as K,O as V,v as z,j as U,aw as X,q as N,aA as R,t as v,h as k,aB as G,aC as W,U as m,aD as j,aE as q,aF as Z,aG as D,aH as $,aI as J,aJ as A,c as b,ac as Q,$ as Y,Q as M,aa as E,aK as ee,b as te,aL as ne,aM as re,aN as ie}from"./index-DnGCQBT-.js";import"./canvasRender-CceJW0CL.js";function h(e,n,t){return t?function(i){return(i.keyCode==e||i.key==n)&&i.code==t}:function(i){return i.keyCode==e||i.key==n}}function F(e,n){var t=[];e.firstChild&&t.push(e.firstChild);for(var i=t.pop();i&&!n(i);)i.nextSibling&&t.push(i.nextSibling),i.firstChild&&t.push(i.firstChild),i=t.pop()}const T={DOM:{supportTouch:P(()=>"ontouchstart"in window),addEvent(e,n,t){e.addEventListener(n,t)},removeEvent(e,n,t){e.removeEventListener(n,t)},preventDefault(e){e.preventDefault()},stopPropagation(e){e.stopPropagation()},getSelectionRange(e){let{anchorNode:n,anchorOffset:t,focusNode:i,focusOffset:r}=L(e);if(!n||!i)return null;if(n==e&&i==e)return{start:t>0&&e.textContent?e.textContent.length:0,end:r>0&&e.textContent?e.textContent.length:0,dir:r>=t?"->":"<-"};if(n.nodeType===Node.ELEMENT_NODE){const o=document.createTextNode("");n.insertBefore(o,n.childNodes[t]),n=o,t=0}if(i.nodeType===Node.ELEMENT_NODE){const o=document.createTextNode("");i.insertBefore(o,i.childNodes[r]),i=o,r=0}var s={start:0,end:0};return F(e,function(o){if(o==n&&o==i)return s.start+=t,s.end+=r,s.dir=t<=r?"->":"<-",!0;if(o===n)if(s.start+=t,!s.dir)s.dir="->";else return!0;else if(o===i)if(s.end+=r,!s.dir)s.dir="<-";else return!0;o.nodeType===Node.TEXT_NODE&&(s.dir!="->"&&(s.start+=o.nodeValue.length),s.dir!="<-"&&(s.end+=o.nodeValue.length))}),e.normalize(),s},setSelectionRange(e,n){if(!n){const u=L(e);return u.removeAllRanges(),u}const t={...n},i=L(e);let r,s=0,o,a=0;if(t.dir||(t.dir="->"),t.start<0&&(t.start=0),t.end<0&&(t.end=0),t.dir=="<-"){const{start:u,end:c}=t;t.start=c,t.end=u}let l=0;return F(e,u=>{if(u.nodeType!==Node.TEXT_NODE)return;const c=(u.nodeValue||"").length;if(l+c>t.start&&(r||(r=u,s=t.start-l),l+c>t.end))return o=u,a=t.end-l,!0;l+=c}),r||(r=e,s=e.childNodes.length),o||(o=e,a=e.childNodes.length),t.dir=="<-"&&([r,s,o,a]=[o,a,r,s]),i.setBaseAndExtent(r,s,o,a),i},keyCode:{BACKSPACE:h(8,"Backspace"),ENTER:h(13,"Enter"),TAB:h(9,"Tab"),ESCAPE:h(27,"Escape"),CAPSLOCK:h(20,"CapsLock"),ARROWLEFT:h(37,"ArrowLeft"),ARROWUP:h(38,"ArrowUp"),ARROWRIGHT:h(39,"ArrowRight"),ARROWDOWN:h(40,"ArrowDown"),CONTROL:h(17,"Control"),SHIFT:h(16,"Shift"),SHIFTLEFT:h(16,"Shift","ShiftLeft"),SHIFTRIGHT:h(16,"Shift","ShiftRight"),META:h(91,"Meta"),METALEFT:h(91,"Meta","MetaLeft"),METARIGHT:h(91,"Meta","MetaRight"),ALT:h(18,"Alt"),ALTLEFT:h(18,"Alt","AltLeft"),ALTRIGHT:h(18,"Alt","AltRight"),A:h(65,"a"),Z:h(90,"z"),V:h(86,"v"),C:h(67,"c"),X:h(88,"x")}},isIE:!1},se=function(){var e={type:"FF",version:0,documentMode:""};if(!globalThis.navigator)return e;var n=navigator.userAgent,t=n.indexOf("Opera")>-1,i=n.indexOf("compatible")>-1&&n.indexOf("MSIE")>-1&&!t,r=n.indexOf("Firefox")>-1,s=n.indexOf("Safari")>-1;if(i){T.isIE=!0;var o=new RegExp("MSIE (\\d+\\.\\d+);");o.test(n),e.type="IE",e.version=parseFloat(RegExp.$1),e.documentMode=document.documentMode}return r&&(e.type="FF"),t&&(e.type="Opera"),s&&(e.type="Safari"),e}();function oe(e){return{scrollLeft:0,scrollTop:0,range:{start:e.length,end:e.length},value:e}}function L(e){var n;return((n=e.parentNode)==null?void 0:n.nodeType)==Node.DOCUMENT_FRAGMENT_NODE?e.parentNode.getSelection():window.getSelection()}function be(e){return{currentIndex:0,history:[oe(e)]}}function I(e){const n=e.textContent||"",t=T.DOM.getSelectionRange(e);if(!t)throw"error-1";return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,value:n,range:t}}function ae(e){return le(e,`
`,1)}function w(e,n){return e-n}function le(e,n,t){const{value:i,range:r,...s}=I(e),[o,a]=[r.start,r.end].sort(w),l=i.slice(0,o),u=i.slice(a,i.length)||`
`;let c=l.length+t;return{...s,value:l+n+u,range:{start:c,end:c,dir:r.dir}}}function ce(e){const{value:n,range:t,...i}=I(e),[r,s]=[t.start,t.end].sort(w),o=n.slice(0,r),a=n.slice(s,n.length);if(r!=s)return{...i,value:o+a,range:{start:r,end:r}};if(r!=0){const l=t.start-1;return{...i,value:o.slice(0,o.length-1)+a,range:{...t,start:l,end:l}}}}function ue(e,n,t="	"){const{value:i,range:r,...s}=I(e),[o,a]=[r.start,r.end].sort(w);if(r.start!=r.end)if(n){const l=i.split(`
`);let u=0;const c=[];let d=!1,f=0,g=0;for(let x=0;x<l.length;x++){const p=l[x],y=u+p.length+1;u<=o&&o<y&&(d=!0,p.startsWith(t)&&u+t.length<=o&&(g=t.length)),d&&p.startsWith(t)?(f++,c.push(p.slice(t.length,p.length))):c.push(p),u<=a&&a<y&&(d=!1),u=y}return{...s,value:c.join(`
`),range:r.start>r.end?{start:r.start-f*t.length,end:r.end-g,dir:r.dir}:{start:r.start-g,end:r.end-f*t.length,dir:r.dir}}}else{const l=i.split(`
`);let u=0;const c=[];let d=!1,f=0;for(let g=0;g<l.length;g++){const x=l[g],p=u+x.length+1;u<=o&&o<p&&(d=!0),d?(f++,c.push(t+x)):c.push(x),u<=a&&a<p&&(d=!1),u=p}return{...s,value:c.join(`
`),range:r.start>r.end?{start:r.start+f*t.length,end:r.end+t.length,dir:r.dir}:{start:r.start+t.length,end:r.end+f*t.length,dir:r.dir}}}else{const l=i.slice(0,o),u=i.slice(a,i.length);if(n){if(l.endsWith(t)){const c=l.length-t.length;return{...s,value:l.slice(0,l.length-t.length)+u,range:{start:c,end:c}}}}else{const c=l.length+t.length;return{...s,value:l+t+u,range:{start:c,end:c}}}}}const Me=se.type=="FF"?!0:"plaintext-only";function fe(e,n){const t=T.DOM.setSelectionRange(e,{...n.range});if(e.scrollTop=n.scrollTop,e.scrollLeft=n.scrollLeft,!t.rangeCount)return;const i=t.getRangeAt(0),r=i.endContainer==e?e.lastElementChild:i;if(r){const s=r.getBoundingClientRect();s.bottom>e.clientHeight?e.scrollTop+=s.bottom-e.clientHeight:s.top<0&&(e.scrollTop+=s.top),s.right>e.clientWidth?e.scrollLeft+=s.right-e.clientWidth:s.left<0&&(e.scrollLeft+=s.left)}}function C(e,n,t=100){const i=e.currentIndex,r=e.history.slice(0,i+1),s=r.length>2?r.at(-1):void 0;if(s&&s.range.start==s.range.end){const o=s.range.start;if(n.range.start==n.range.end){const l=n.range.start-o;if(0<=l&&n.value.startsWith(s.value)&&n.value.length-s.value.length==l)return r.pop(),r.push(n),{currentIndex:i,history:r}}}return r.push(n),r.length>t?(r.shift(),{currentIndex:i,history:r}):{currentIndex:i+1,history:r}}var de=Object.defineProperty,he=(e,n,t)=>n in e?de(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,O=(e,n,t)=>he(e,typeof n!="symbol"?n+"":n,t);function ge(e,n){const t=document.createElement(e);return t.style.position="absolute",t.style.minWidth="0px",Ee(t,n,!1)}j(q,e=>function(n){return ge(e,n)});function S(e){return function(n){return function(){const t=n();try{return t.getInfo(e)}catch{try{return t.parent.getChildInfo(e,t.index())}catch{return t.getInfo(e,!0)}}}}}const pe=S("x"),xe=S("y"),Te=S("width"),ye=S("height");function Ee(e,n,t){let i,r,s,o;function a(){return d}const l=A(n.x,a,pe),u=A(n.y,a,xe);if(n.width=="auto"){const f=b(0);s=f.get,i=f.set}else s=A(n.width,a,Te);if(n.height=="auto"){const f=b(0);o=f.get,r=f.set}else o=A(n.height,a,ye);const c=Q();(i||r)&&v(()=>{const f=()=>{i==null||i(e.clientWidth),r==null||r(e.clientHeight),m()};f();const g=new ResizeObserver(f);g.observe(e),c(()=>{g.disconnect()})},-2);const d=new ve(e,l,u,s,o,t,n);return G(d),!n.childrenType&&n.children?d.children=Ie(n.children,d.target,d):d.children=Y(M),v(()=>{c(E(d.x,f=>d.target.style.left=f+"px")),c(E(d.y,f=>d.target.style.top=f+"px")),i||c(E(d.width,f=>d.target.style.width=f+"px")),r||c(E(d.height,f=>d.target.style.height=f+"px"))},-1),v(()=>{function f(g,x,p){const y=arguments[3];typeof x=="function"?c(E(()=>x(d),p,g,y)):p(x,g,y)}ee(e,n,f,k,M)}),d}function Ce(e){return e.target}class ve{constructor(n,t,i,r,s,o,a){O(this,"display"),O(this,"children"),O(this,"parent"),O(this,"__index"),this.target=n,this.x=t,this.y=i,this.width=r,this.height=s,this.isSVG=o,this.configure=a;const l=R(a.m_display||Ae);this.display=te(()=>ne(this,l))}getExt(){return this.configure}index(){return this.parent.children(),this.__index}getChildInfo(n,t){return this.display().getChildInfo(n,t)}getInfo(n,t){return this.display().getInfo(n,t)}}function Ie(e,n,t){const i=re(e,t,r=>{r.forEach((s,o)=>{s.__index=o,s.parent&&s.parent!=t&&console.log("parent发生改变",s.parent,t),s.parent=t})});return N(i,ie(n,Ce)),i}const Ae={getChildInfo(e,n){throw"no child location "+e},getInfo(e,n){if(n)return 0;throw e=="x"||e=="y"?"no self location "+e:"no default value for"+e}};function B(e,n,t,i){const r=function(){t.set(r.value)};N(()=>{i();const s=e();n.shouldChange(s,t.get())&&(r.value=n.toComponentValue(s),v(r))})}function H(e,n,t,i,r){const[s,o]=W(),a=R("onInput");i.input.addEventListener("input",function(l){a()=="onInput"&&(o(),t.fromComponent(i.get(),n),m())}),i.input.addEventListener("blur",function(l){a()=="onBlur"&&(o(),t.fromComponent(i.get(),n),m())}),B(e,t,i,s)}function Fe(e,n,t,i,r){return H(n,t,e||D,new Z(i)),i}function Oe(e,n,t,i,r){return H(n,t,e,new $(i)),i}function _e(e,n,t,i){return Oe(D,e,n,t)}function me(e,n,t,i){const[r,s]=W();return t.addEventListener("input",function(o){s(),i.fromComponent(t.checked,n),m()}),B(e,i,new J(t),r),t}function ke(e,n,t){return me(e,n,t,D)}function Ne(e){const n=e.currentIndex+1;return n<e.history.length?{...e,currentIndex:n}:e}function Se(e){return e.currentIndex?{...e,currentIndex:e.currentIndex-1}:e}function Le(e){function n(){const t=e();return t.history[t.currentIndex]}return{current:n,renderContentEditable({noFocus:t,children:i}){const r=R(t);X(()=>n().value,function(s){const o=i(s);N(()=>{r()||v(()=>{fe(o,n())})},k)})}}}function Ge(e){const{current:n,renderContentEditable:t}=Le(e.get);return{current:n,renderContentEditable({noFocus:i,render:r}){t({noFocus:i,children(s){const o=r(s,{onInput(a){a.isComposing||e.set(C(e.get(),I(o)))},onCompositionEnd(){e.set(C(e.get(),I(o)))},onKeyDown(a){if(T.DOM.keyCode.TAB(a)){a.preventDefault();const l=ue(o,a.shiftKey);l&&e.set(C(e.get(),l))}else if(T.DOM.keyCode.ENTER(a)){a.preventDefault();const l=ae(o);e.set(C(e.get(),l))}else if(T.DOM.keyCode.Z(a))Re(a)&&(a.shiftKey?(a.preventDefault(),e.set(Ne(e.get()))):(a.preventDefault(),e.set(Se(e.get()))));else if(T.DOM.keyCode.BACKSPACE(a)){a.preventDefault();const l=ce(o);l&&e.set(C(e.get(),l))}}});return o}})}}}function Re(e){return e.metaKey||e.ctrlKey}function We(e,n){z(e,(t,i)=>{let r;U(()=>{const s=t.step();return s=="exiting"||s=="will-exiting"},()=>{var s;"node"in r?_(r,t):((s=r.call)==null||s.call(r),r.list.forEach(o=>{_(o,t)}))},()=>{r=n(t,i)})})}function _(e,n){const t=e.node.cloneNode(!0);G(t);const i=e.applyAnimate;N(n.step,r=>{r=="exiting"&&i(t)})}function Be(e,n){const[t,i]=K(e,n);return V(i),t}export{Oe as a,ke as b,Me as c,We as d,Ge as e,_e as f,Be as h,be as i,Fe as r};
