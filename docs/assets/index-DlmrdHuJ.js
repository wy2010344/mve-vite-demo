import{f as m}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as h,e as u,i as N,aj as X,m as Y,ap as w,ai as n,h as C,a as k,ao as M,aq as p,D as W,I as $,ar as B}from"./index-BdTCZeBf.js";import{m as E,f as R,a as q,b,t as z,i as P,e as j,d as S}from"./forceLayout-B4nbHEBX.js";const D=800,F=800,H=.001;let O=0;function U(){const c=h(u),a=h(u),i=h(void 0);N(X(document,"keydown",t=>{if(t.key=="Enter"){const e=i.get();e&&(i.set(void 0),c.set(c.get().filter(s=>s.value!=e.value)),a.set(a.get().filter(s=>s.source!=e.value&&s.target!=e.value)),l())}}));const f=2,d=Y(t=>E({nodes:(t==null?void 0:t.nodes)||u,links:(t==null?void 0:t.links)||u,fromLinks:a.get(),fromNodes:c.get(),createForceNode(e,s,r){return{index:s,x:S(e.x),y:S(e.y),z:j,value:e}},getNodeKey(e){return e.value},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{value:e,color:m.color.rgb(),x:0,y:0}}})),g=w(P()),_=()=>g.alpha<H,L=R(),T=q(),A=b("x"),I=b("y");function l(){const t=d();z(f,g,t.nodes,e=>{L(t.links,f,e),T(t.nodes,f,e),A(t.nodes,e),I(t.nodes,e)})}const y=n.svg({width:D,height:F,viewBox:`${-800/2} ${-800/2} ${D} ${F}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(t){const e={value:O++,color:m.color.rgb(),x:t.offsetX-y.clientWidth/2,y:t.offsetY-y.clientHeight/2};c.set([...c.get(),e]),i.set(e),l(),p()},children(){let t=W;C(_,e=>{if(e){t();return}t=$(()=>{l(),p()})}),k(()=>d().links,e=>n.g({stroke:"#999",strokeOpacity:.6,children(){n.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),k(()=>d().nodes,e=>n.g({stroke:"#fff",strokeWidth:1.5,onClick(s){s.stopPropagation();const r=i.get();if(s.shiftKey){if(r&&r!=e.value){if(a.get().findIndex(o=>o.source==r.value&&o.target==e.value.value)<0)a.set([...a.get(),{source:r.value,target:e.value.value}]);else{const o=a.get().slice();a.set(o)}l()}}else r==e.value?i.set(void 0):i.set(e.value)},...M(s=>{const r=y.getBoundingClientRect(),v=r.left+r.width/2,o=r.top+r.height/2;e.x.f=s.pageX-v,e.y.f=s.pageY-o,g.alphaTarget=.3,l();const K=B(x=>{x?(e.x.f=x.pageX-v,e.y.f=x.pageY-o):(e.x.f=void 0,e.y.f=void 0,g.alphaTarget=0,K())})}),children(){n.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return i.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),n.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{U as default};
