import{aS as S,c as v,z as H,aT as h,Q as y,f as B,aU as I,aR as O,aO as p,w as R,d as E,o as N,i as k,aV as z,N as D,aW as F}from"./index-D84f0y8o.js";import M from"./column-BDT2nT4Q.js";import{taskContext as P}from"./context-BfZLldrG.js";import W from"./cardBase-BXPDxfge.js";import"./columnBase-2e2OBqoc.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./xmlRender-t-ysRih2.js";import"./index-CROfFFTi.js";import"./iconBase-B9IP-JiR.js";import"./mve-icon-C6ezsOuC.js";import"./index-BQKsZa9b.js";import"./index-GzwYIlJs.js";import"./index-BHzW6WMu.js";function te({tasks:C,columns:T}){const d=S(C),a=v(void 0),l=H(()=>{const r=a.get();if(r)return d.get().find(e=>e.id==r.id)}),{dragX:c,dragY:m,backHolder:g,targetHolder:f,activeColumn:w}=P.provide({tasks:d,dragData:a,dragTask:l,dragX:y(0),dragY:y(0),columns:new Map,targetHolder:h(void 0),backHolder:h(void 0),activeColumn:v(void 0)});B.div({plugin:I({shouldMeasure:a.get,direction:"x"}),className:"flex gap-6 overflow-x-auto overflow-y-hidden pb-6 flex-1 relative",children(){T.map(e=>{O(()=>{p.renderChild(M(e))})});function r(){a.set(void 0),f.set(void 0),g.set(void 0),w.set(void 0)}R(a.get,e=>{e&&(E(e.type.get,function(n){n=="cancel"?k(()=>{const o=g.get();if(o){const s=o.getBoundingClientRect();Promise.all([c.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{r()})}}):n=="move"&&k(()=>{const o=f.get();if(o){const s=o.element.getBoundingClientRect();Promise.all([c.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{const b=l(),u=o.getBeforeId(),_=d.set(function(t){t=[...t];const x={...b,type:o.type};if(z(t,i=>i.id==e.id),u){for(let i=0;i<t.length;i++)if(t[i].id==u){t.splice(i,0,x);break}}else t.push(x);return t});r(),setTimeout(()=>{_.commit()},10*1e3)})}})}),N(l,function(){p.renderChild(p.createElement(W,{selected:F,onDelete:D,getTask:l,className:"pointer-events-none opacity-90 fixed",s_zIndex:1e3,s_width:e.width+"px",s_height:e.height+"px",s_top:()=>m.get()-e.y+"px",s_left:()=>c.get()-e.x+"px",s_transformOrigin:`${e.x}px ${e.y}px`,s_rotate:()=>{var n;return(n=a.get())!=null&&n.type.get()?"0deg":"-15deg"}}))}))})}})}export{te as default};
