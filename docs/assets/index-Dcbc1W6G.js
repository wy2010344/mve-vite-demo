import{c as g,br as M,f as r,d as x,l as w,e as A,bs as z,bt as C,a3 as G,o as U,aQ as J,k as Z,h as V,i as T,bu as X,aM as j}from"./index-Bn6QTqXa.js";import{hookDebounceState as E}from"./hooks-CVc9qc08.js";import{v as W,r as B}from"./index-XVZQUbQ5.js";import{markerRender as H}from"./markerRender-CsKIOHJ_.js";import{MapService as O}from"./mapService-dD-mDC-q.js";import{renderLoadingIndicator as F,renderSearchResults as K,renderInfoWindow as Q,renderMapLoading as q}from"./uiComponents-DbIhd2Ey.js";import"./canvasRender-DlxfwZGY.js";import"./_commonjsHelpers-CqkleIqs.js";const D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAfCAYAAAAFkva3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAGHaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49J++7vycgaWQ9J1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCc/Pg0KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyI+PHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj48dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPjwvcmRmOkRlc2NyaXB0aW9uPjwvcmRmOlJERj48L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9J3cnPz4slJgLAAADEUlEQVRIS52UX2iVZRzHP8/T6fxZWAssIbpMB8Xwol04BJ0nBFtQXtSFSSIqDPSqnVIIEqYM2UaEIMjwKmHGFuEagTbcYqXLm+kwUMS13WiMnXn+5Tl7j53n9+uiNs55tnPa8XP3fr/f5/O+PBevYQ3e78m/VkL3Y3hP0c3ARmARNTMGfgxhBkZOvPCnf86UP7zdr8+/ms6dVEjYWDRmwiGMtWABARVBn5aQpWDJwFcLL794aqrD/L1K9sHX6cagaL+30UjcNkS4eGrzykt8Dpx8gBSK6FLxZwnrh6OJxhTLso+G9LnsH+mfbEPsnYG+Zv9sVfZ//jtSCH57KWhs+67LPLUAmQepL00kUpcIYKCvGRMJt2bCqS8AbLx7fhMix4lF/e36iEVB5Hi8e36TtWI+0Vg0dqm7yZ+ti0vdTWgsGjPOHLDOuXbCIX9TH+EQIu5dq8hbg7313ZXPYG8zqvKmVScb/fJZUJFXrIor+MUzoZK3iszsTUz7VV3s/WwaETdrReQXLS75fV1oEKDqfrU4/dYV8n5fF67wBHUM2Bu9W24S5Cfaj173N+ui/eh1CPITN3q33LQARksdpJPFPYlb/rYmexK3IJ0sGi11wL8/Fyb7tt4XJz1kM/6+NtkM4qRnsm/rfZZlAA0bUmc0szi3+9hkxb4au49NopnFuYYNqTPL2YpsomtXoCqd5NIrB2qSS6MqnRNdu4LlaEUGMHW2ZZi/smPxI+Pl8SriR8bRJ9nxqbMtw+V5hQxAnes0yUfi5+WY5COh5D7181Wy2+db76i4oZ2HRv0KgJ2HRlFxQ7fPt97xu1UyACNy2i48VD8HsAsP1Yic9nOqyab7d9wVkZHth69V5NsPX0NERqb7d9ytKP5jTRmAUz1nMsmKzGSSONVzFWEZVWX3LrSNkc/NVoT53Oy9C21jFVkZVWVgVJ37Ztu+ywBs23cZFXcRzJp3SW0ZiMiQyaUAMLkU4mTQ39RF08ErM49ff0ObDl6Z8Tufml8GIKJXWz4eRkSv+p3P/8pQGQ7Nz+VU9Ae/8vkHL2ponhzx25oAAAAASUVORK5CYII=",v=[{value:"全国",label:"全国",center:[116.397428,39.90923],zoom:4},{value:"深圳",label:"深圳",center:[114.066541,22.547],zoom:12},{value:"重庆",label:"重庆",center:[106.550763,29.563009],zoom:12}];function se(){const p=g(""),Y=E(p.get,300),b=g(""),u=W("selectCity","全国"),h=g(!1),y=C(void 0);function S(){const e=y.get();if(e?.type=="success")return e.value}const I=M(()=>{const e=Y();if(!e)return;const a=S();if(a)return function(){return new Promise(function(s){a.plugin("AMap.AutoComplete",()=>{new window.AMap.AutoComplete({city:u.get()}).search(e,(l,n)=>{if(l==="complete"&&n.tips){const t=n.tips.map(o=>({name:o.name,address:o.district+o.address,dropdown:!0,position:o.location?[o.location.lng,o.location.lat]:null}));s(t)}else s(A)})})})}}),k=M(()=>{const e=b.get();if(!e)return;const a=S();if(a)return function(){return new Promise(s=>{a.plugin("AMap.PlaceSearch",()=>{new window.AMap.PlaceSearch({city:u.get(),pageSize:10,pageIndex:1,autoFitView:!0}).search(e,(l,n)=>{l==="complete"&&n.poiList&&n.poiList.pois.length>0?s(n.poiList.pois.map(t=>({name:t.name,address:t.address,place:!0,position:[t.location.lng,t.location.lat]}))):s(A)})})})}}),P=W("favoritePoints",A),N=g(void 0);function R(e,a){return!!e.find(s=>s.address==a.address&&s.name==a.name)}r.div({className:"w-full h-screen bg-gray-50 flex flex-col",children(){r.div({className:"p-4 bg-white shadow-sm",children(){r.div({className:"relative max-w-3xl mx-auto",children(){r.div({className:"flex gap-4 mb-3",children(){r.div({className:"relative flex-1",children(){r.select({className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 appearance-none text-gray-900",value:u.get,onInput(e){const a=e.target;u.set(a.value)},children(){v.forEach(e=>{r.option({value:e.value,children:e.label,className:"text-gray-900"})})}}),r.div({className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-500",children(){x.svg({className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children(){x.path({strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}})}})}})}}),r.div({className:"relative",children(){B(p.get,p.set,r.input({type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500",placeholder:"搜索地点...",onFocus(){h.set(!0)},onBlur(){setTimeout(()=>{h.set(!1)},200)},onKeyDown(e){e.key==="Enter"&&p.get()&&b.set(p.get())},disabled:L})),w(()=>L(),function(e){e&&F()})}}),w(()=>{if(!h.get())return A;const e=I.get();return e?.type!="success"?A:e.value},function(e){K(e,a=>{N.set(a)})})}})}}),r.div({className:"flex-1 relative",children(){const e=r.div({className:"w-full h-full"}),{get:a}=z(new Promise((c,l)=>{G(async()=>{try{const n=await O.initMap(e,[114.066541,22.547],12);c(n)}catch(n){l(n)}})}),{signal:y}),s=U(()=>P.get().map(c=>({...c,favorite:!0})));J(a,"type",function(c,l){c=="success"?w(()=>l().value,function(n){Z(()=>{n.destroy()}),V(u.get,()=>{const t=v.find(o=>o.value===u.get())||v[0];n.setCenter(t.center),n.setZoom(t.zoom)}),H.renderChildren(n,function(){T(()=>{let t=s();const o=N.get();o&&!R(t,o)&&(t=t.concat({...o,dropdown:!0}));const i=k.get();if(i?.type=="success"){const f=i.value;if(f.length){const m=[...t];f.forEach(d=>{R(t,d)||m.push(d)}),t=m}}return t},t=>[t.address,t.name],function(t){const o=t(),i=new window.AMap.Marker({position:o.position,label:o.name,icon:D,offset:new window.AMap.Pixel(-10,-30),zIndex:100});V(t,function(d){i.setPosition(d.position),i.setLabel(d.name)}),j(i);let f=null;Z(()=>{f?.close()});function m(){try{f=Q({map:n,marker:i,get:t,favoritePoints:P})}catch(d){console.error("创建信息窗口失败:",d)}}i.on("mouseover",m),i.on("click",m),i.on("touchstart",m)},X)})}):q()})}})}});function L(){return!y.get()||k.loading()}}export{se as default};
