import{bg as H,c as x,m as S,aC as v,H as b,g as B,bh as I,bf as D,j as E,h as O,k as R,f as k,bi as j,bd as g,D as F,bj as M}from"./index-8-4crGqb.js";import N from"./column-Bb-HKDxg.js";import{taskContext as P}from"./context-BeV4Cq1e.js";import X from"./cardBase-DigYx8dJ.js";import"./columnBase-Dv2EFVeE.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./xmlRender-DpHHh9d-.js";import"./index-DDyGFxxM.js";import"./mve-icon-Cq61_dwU.js";function U({tasks:y,columns:C}){const d=H(y),a=x(void 0),l=S(()=>{const n=a.get();if(n)return d.get().find(e=>e.id==n.id)}),{dragX:c,dragY:m,backHolder:f,targetHolder:p,activeColumn:T}=P.provide({tasks:d,dragData:a,dragTask:l,dragX:b(0),dragY:b(0),columns:new Map,targetHolder:v(void 0),backHolder:v(void 0),activeColumn:x(void 0)});B.div({plugins:[I({shouldMeasure:a.get,direction:"x"})],className:"flex gap-6 overflow-x-auto overflow-y-hidden pb-6 flex-1 relative",children(){C.map(e=>{D(()=>{g.renderChild(N(e))})});function n(){a.set(void 0),p.set(void 0),f.set(void 0),T.set(void 0)}E(a.get,e=>{e&&(O(e.type.get,function(r){r=="cancel"?k(()=>{const o=f.get();if(o){const s=o.getBoundingClientRect();Promise.all([c.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{n()})}}):r=="move"&&k(()=>{const o=p.get();if(o){const s=o.element.getBoundingClientRect();Promise.all([c.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{const w=l(),u=o.getBeforeId(),_=d.set(function(t){t=[...t];const h={...w,type:o.type};if(j(t,i=>i.id==e.id),u){for(let i=0;i<t.length;i++)if(t[i].id==u){t.splice(i,0,h);break}}else t.push(h);return t});n(),setTimeout(()=>{_.commit()},10*1e3)})}})}),R(l,function(){g.renderChild(g.createElement(X,{selected:M,onDelete:F,getTask:l,className:"pointer-events-none opacity-90 fixed",s_zIndex:1e3,s_width:e.width+"px",s_height:e.height+"px",s_top:()=>m.get()-e.y+"px",s_left:()=>c.get()-e.x+"px",s_transformOrigin:`${e.x}px ${e.y}px`,s_rotate:()=>{var r;return(r=a.get())!=null&&r.type.get()?"0deg":"-15deg"}}))}))})}})}export{U as default};
