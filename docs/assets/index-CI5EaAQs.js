import{c as C,k as j,an as S,b as M,ar as Z,f as Q,z as ee,d as te,aq as se,n as ne,e as K,h as D,E as oe,J as re,as as ae,at as ie,j as X,al as W,w as ce,b4 as U,bk as de}from"./index--sZwA4wO.js";import ge from"./graph-BB3NgaJ2.js";import{c as fe,o as ue}from"./transform-W4V8p7Sk.js";import{f as le,a as pe,b as Y,i as he,m as me,t as ye,d as be,e as xe,c as ve}from"./forceLayout-CtzQsQK8.js";import{g as we,r as ke,T as Se,h as ze}from"./hookThreeView-BcSoSFZg.js";import{b as Te}from"./index-DManKRps.js";import{C as Le,cb as Ce,cc as H,cp as Me,cq as De,h as Fe,ci as Ae,ap as Be,cr as Ne,V as I,an as _e,cs as Re,ct as Xe,j as Ye}from"./three.core-CVFNDdqD.js";import"./three.module-iyRXV4cU.js";import"./index-CMyapRKq.js";import"./iconBase-7EIOOMs7.js";import"./index-BHzW6WMu.js";const Ee=fe("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),F=800,A=800,Oe=.001,Pe=["2D","3D"];function Qe(){const z=C("3D");Te({options:Pe,value:z.get,onChange:z.set,renderChild(f){te.span().renderTextContent(f)}});const p=C(ge),v=ue(Ee),w=le(),y=pe(),b=Y("x"),E=Y("y");function O(f,u){const l=se(he()),x=()=>l.alpha<Oe,h=ne(n=>me({nodes:(n==null?void 0:n.nodes)||K,links:(n==null?void 0:n.links)||K,fromLinks:p.get().links,fromNodes:p.get().nodes,createForceNode(e,i,g){return be(e,f,i,ve,xe)},getNodeKey(e){return e.id},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{id:e,group:"not-found"}}}));function s(){const n=h();ye(f,l,n.nodes,e=>{w(n.links,f,e),y(n.nodes,f,e),u(n,e)})}let c=oe;return D(x,n=>{if(n){c();return}c=re(()=>{s(),ae()})}),{config:l,getNodesAndLinks:h,didTick:s}}j(z.get,function(f){if(f=="2D"){const{getNodesAndLinks:u,didTick:l,config:x}=O(2,(s,c)=>{b(s.nodes,c),E(s.nodes,c)}),h=S.svg({width:F,height:A,viewBox:`${-800/2} ${-800/2} ${F} ${A}`,s_maxWidth:"100%",s_height:"auto",children(){M(()=>u().links,s=>S.g({stroke:"#999",strokeOpacity:.6,children(){S.line({x1:s.source.x.dSignal.get,y1:s.source.y.dSignal.get,x2:s.target.x.dSignal.get,y2:s.target.y.dSignal.get,strokeWidth:Math.sqrt(s.value.value)})}})),M(()=>u().nodes,s=>S.g({stroke:"#fff",strokeWidth:1.5,children(){S.circle({r:5,cx:s.x.dSignal.get,cy:s.y.dSignal.get,fill:v(s.value.group),...Z(c=>{const n=h.getBoundingClientRect(),e=n.left+n.width/2,i=n.top+n.height/2;s.x.f=c.pageX-e,s.y.f=c.pageY-i,x.alphaTarget=.3,l();const g=ie(d=>{d?(s.x.f=d.pageX-e,s.y.f=d.pageY-i):(s.x.f=void 0,s.y.f=void 0,x.alphaTarget=0,g())})})})}}))}})}else if(f=="3D"){const u=C(void 0),l=C(void 0);j(u.get,function(e){if(!e)return;const i=e.userData;Q.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){var g;return(((g=l.get())==null?void 0:g.clientX)||0)+15+"px"},s_top(){var g;return(((g=l.get())==null?void 0:g.clientY)||0)+15+"px"},children(){ee`${i.value.group}--${i.value.citing_patents_count||""}`}})});const x=Y("z"),{getNodesAndLinks:h,didTick:s,config:c}=O(3,(e,i)=>{b(e.nodes,i),E(e.nodes,i),x(e.nodes,i)}),n=we(F,A);n.position.z=500,ke({camera:n,width:F,height:A,render(e){const{renderer:i}=Se.consume();e.background=new Le(16119802);const g=new Ce(16777215,.4);e.add(g);const d=new H(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,e.add(d);const P=new H(16777215,.3);P.position.set(-5,5,5),e.add(P);const $=ze(),J=new Me(5,32,32);function B(o,a){o.x=a.x.d,o.y=a.y.d,o.z=a.z.d}const k=new De,T=new Fe,N=[],L=i.domElement;function q(o,a,t){const r=a.clientX-t.left,m=a.clientY-t.top;o.x=r/t.width*2-1,o.y=-(m/t.height*2-1)}function G(o,a){q(T,o,a),k.setFromCamera(T,n);const t=k.intersectObjects(N);if(t.length>0)return t[0].object}X(W(L,"pointermove",o=>{const a=L.getBoundingClientRect(),t=G(o,a);t?(u.set(t),l.set(o)):u.set(void 0)})),X(W(L,"pointerdown",o=>{const a=L.getBoundingClientRect(),t=G(o,a);if(t){$.enabled=!1;const r=t.userData;r.z.f=r.z.d,c.alphaTarget=.3,s(),ce({onMove(m){q(T,m,a),k.setFromCamera(T,n);const _=k.ray.direction,R=k.ray.origin,V=(r.z.f-R.z)/_.z;r.x.f=R.x+_.x*V,r.y.f=R.y+_.y*V},onEnd(m){r.x.f=void 0,r.y.f=void 0,c.alphaTarget=0,$.enabled=!0}})}})),M(()=>h().nodes,o=>{const a=v(o.value.group),t=new Ae({color:a,specular:1118481,shininess:50,bumpMap:$e(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Be(J,t);U(r),r.userData=o,N.push(r),X(()=>{de(N,r)}),D(()=>{u.get()==r?t.emissive.setHex(3355443):t.emissive.set(a)}),D(()=>{B(r.position,o)})}),M(()=>h().links,o=>{const a=new Ne({color:0,transparent:!0,opacity:.3}),t=[];t.push(new I),t.push(new I);const r=new _e().setFromPoints(t),m=new Re(r,a);U(m),D(()=>{B(t[0],o.source),B(t[1],o.target),m.geometry=r.setFromPoints(t)})})}})}})}function $e(){const p=new Uint8Array(16384);for(let w=0;w<64*64;w++){const y=w*4,b=Math.random()*255;p[y]=b,p[y+1]=b,p[y+2]=b,p[y+3]=255}const v=new Xe(p,64,64,Ye);return v.needsUpdate=!0,v}export{Qe as default};
