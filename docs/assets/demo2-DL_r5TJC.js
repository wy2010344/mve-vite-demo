import{f as h}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as x,A as u,h as K,s as N,m as X,B as Y,z as c,b as w,C as B,E,F as m,G as I,u as k,H as M}from"./index-DKe6Phur.js";import{m as W,f as $,a as z,b as p,e as R,d as b,c as H,t as P}from"./forceLayout-B3R87JJo.js";const S=800,F=800,q=.001;let G=0;function Q(){const l=x(u),o=x(u),i=x(void 0);K(N(document,"keydown",t=>{if(t.key=="Enter"){const e=i.get();e&&(i.set(void 0),l.set(l.get().filter(s=>s.value!=e.value)),o.set(o.get().filter(s=>s.source!=e.value&&s.target!=e.value)),g())}}));const f=X(t=>W({nodes:(t==null?void 0:t.nodes)||u,links:(t==null?void 0:t.links)||u,fromLinks:o.get(),fromNodes:l.get(),createForceNode(e,s,r){return{index:s,x:b(e.x),y:b(e.y),z:R,value:e}},getNodeKey(e){return e.value},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{value:e,color:h.color.rgb(),x:0,y:0}}})),n=Y(H()),D=()=>n.alpha<q,_=$(),A=z(),L=p("x"),T=p("y");function g(){const t=f();P(n,t.nodes,e=>{_(t.links,n.nDim,e),A(t.nodes,n.nDim,e),L(t.nodes,e),T(t.nodes,e)})}const d=c.svg({width:S,height:F,viewBox:`${-800/2} ${-800/2} ${S} ${F}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(t){const e={value:G++,color:h.color.rgb(),x:t.offsetX-d.clientWidth/2,y:t.offsetY-d.clientHeight/2};l.set([...l.get(),e]),i.set(e),g(),k()},children(){let t=B;w(D,e=>{if(e){t();return}t=E(()=>{g(),k()})}),m(()=>f().links,e=>c.g({stroke:"#999",strokeOpacity:.6,children(){c.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),m(()=>f().nodes,e=>c.g({stroke:"#fff",strokeWidth:1.5,onClick(s){s.stopPropagation();const r=i.get();if(s.shiftKey){if(r&&r!=e.value){if(o.get().findIndex(a=>a.source==r.value&&a.target==e.value.value)<0)o.set([...o.get(),{source:r.value,target:e.value.value}]);else{const a=o.get().slice();o.set(a)}g()}}else r==e.value?i.set(void 0):i.set(e.value)},...I(s=>{const r=d.getBoundingClientRect(),y=r.left+r.width/2,a=r.top+r.height/2;e.x.f=s.pageX-y,e.y.f=s.pageY-a,n.alphaTarget=.3,g();const C=M(v=>{v?(e.x.f=v.pageX-y,e.y.f=v.pageY-a):(e.x.f=void 0,e.y.f=void 0,n.alphaTarget=0,C())})}),children(){c.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return i.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),c.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{Q as default};
