import{m as y,c as Y,bd as p,bh as H,i as x,bk as R,v as L,h as P}from"./index-8-4crGqb.js";import K from"./columnBase-Dv2EFVeE.js";import{ArrayRender as W}from"./xmlRender-DpHHh9d-.js";import{taskContext as j}from"./context-BeV4Cq1e.js";import q from"./cardBase-DigYx8dJ.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./index-DDyGFxxM.js";import"./mve-icon-Cq61_dwU.js";function _({title:B,type:a}){const{tasks:f,dragData:c,dragX:h,dragY:m,columns:v,activeColumn:u,backHolder:E,targetHolder:I,dragTask:S}=j.consume();function b(e,{whenIntoTarget:r,whenIntoDraft:o,whenNotDist:t}){let i=e.target;for(;i;){for(let[n,s]of v)if(s==i){r(n);return}i=i.parentElement}t==null||t()}const d=y(function(){return f.get().filter(e=>{if(e.type!=a)return!1;const r=c.get();return!(r&&r.type.get()!="cancel"&&e.id==r.id)})}),C=new Map,w=Y(0);let X;const T=y(()=>{if(!c.get()||u.get()!=a)return-1;const r=m.get(),o=X.getBoundingClientRect(),t=w.get();if(r<o.top||r>o.bottom)return-1;const i=d();for(let n=0;n<i.length;n++){const s=i[n],g=C.get(s.id);if(!g)throw"";const l=g.offsetTop+o.top-t;if(r<l+g.clientHeight/2)return n}return i.length}),D=y(()=>{const e=T();if(e<0)return d();const r=S();if(!r)return d();const o=[...d()];return o.splice(e,0,{...r,type:a}),o});return p.createElement(K,{type:a,title:B,tasks:f.original,getTasks:d,plugins:[e=>{e.addEventListener("scroll",r=>{w.set(e.scrollTop)})},H({shouldMeasure(){return T()>-1},direction:"y",multi:3}),e=>{X=e,v.set(a,e),x(()=>{v.delete(a)})}]},p.createElement(W,{getArray:D,getKey:e=>e.id,render:(e,r,o)=>{p.renderChild(p.createElement(q,{plugins:[R(r,"y"),t=>{var i;C.set(o,t),x(()=>{C.delete(o)}),P(()=>{var n;return o==((n=c.get())==null?void 0:n.id)&&u.get()==a},function(n){n&&I.set({type:a,element:t,getBeforeId(){var s;return(s=d()[T()])==null?void 0:s.id}})}),((i=c.get())==null?void 0:i.type.get())=="cancel"&&E.set(t)}],selected:()=>{var t;return((t=c.get())==null?void 0:t.id)==o},onDelete:()=>{f.original.set(f.original.get().filter(t=>t.id!=o))},className:()=>{var t;return((t=c.get())==null?void 0:t.id)==o?"opacity-0":""},getTask:e,onPointerDown:t=>{if(c.get())return;const n=t.currentTarget.getBoundingClientRect();h.set(t.pageX),m.set(t.pageY);const s={width:n.width,height:n.height,x:t.pageX-n.x,y:t.pageY-n.y,id:o,type:Y(void 0)};c.set(s);let g=t;document.body.style.userSelect="none",L({onMove(l){b(l,{whenIntoTarget(A){u.set(A)}});const k=l.pageX-g.pageX,M=l.pageY-g.pageY;h.set(h.get()+k),m.set(m.get()+M),g=l},onEnd(l){document.body.style.userSelect="",b(l,{whenIntoTarget(k){u.set(k),s.type.set("move")},whenNotDist(){u.set(void 0),s.type.set("cancel")}})}})}}))}}))}export{_ as default};
