import{f as k}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as h,e as u,j as X,al as Y,n as w,aq as C,an as n,h as E,b as m,ar as I,as as p,E as M,J as W,at as $}from"./index--sZwA4wO.js";import{m as B,f as R,a as q,b,t as z,i as P,e as j,c as S}from"./forceLayout-CtzQsQK8.js";const F=800,D=800,H=.001;let J=0;function U(){const c=h(u),a=h(u),o=h(void 0);X(Y(document,"keydown",t=>{if(t.key=="Enter"){const e=o.get();e&&(o.set(void 0),c.set(c.get().filter(s=>s.value!=e.value)),a.set(a.get().filter(s=>s.source!=e.value&&s.target!=e.value)),l())}}));const f=2,d=w(t=>B({nodes:(t==null?void 0:t.nodes)||u,links:(t==null?void 0:t.links)||u,fromLinks:a.get(),fromNodes:c.get(),createForceNode(e,s,r){return{index:s,x:S(e.x),y:S(e.y),z:j,value:e}},getNodeKey(e){return e.value},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{value:e,color:k.color.rgb(),x:0,y:0}}})),g=C(P()),_=()=>g.alpha<H,L=R(),T=q(),A=b("x"),K=b("y");function l(){const t=d();z(f,g,t.nodes,e=>{L(t.links,f,e),T(t.nodes,f,e),A(t.nodes,e),K(t.nodes,e)})}const y=n.svg({width:F,height:D,viewBox:`${-800/2} ${-800/2} ${F} ${D}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(t){const e={value:J++,color:k.color.rgb(),x:t.offsetX-y.clientWidth/2,y:t.offsetY-y.clientHeight/2};c.set([...c.get(),e]),o.set(e),l(),p()},children(){let t=M;E(_,e=>{if(e){t();return}t=W(()=>{l(),p()})}),m(()=>d().links,e=>n.g({stroke:"#999",strokeOpacity:.6,children(){n.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),m(()=>d().nodes,e=>n.g({stroke:"#fff",strokeWidth:1.5,onClick(s){s.stopPropagation();const r=o.get();if(s.shiftKey){if(r&&r!=e.value){if(a.get().findIndex(i=>i.source==r.value&&i.target==e.value.value)<0)a.set([...a.get(),{source:r.value,target:e.value.value}]);else{const i=a.get().slice();a.set(i)}l()}}else r==e.value?o.set(void 0):o.set(e.value)},...I(s=>{const r=y.getBoundingClientRect(),v=r.left+r.width/2,i=r.top+r.height/2;e.x.f=s.pageX-v,e.y.f=s.pageY-i,g.alphaTarget=.3,l();const N=$(x=>{x?(e.x.f=x.pageX-v,e.y.f=x.pageY-i):(e.x.f=void 0,e.y.f=void 0,g.alphaTarget=0,N())})}),children(){n.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return o.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),n.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{U as default};
