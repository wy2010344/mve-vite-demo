import{aS as S,z as $,c as v,aT as h,Q as y,f as H,aU as B,aR as I,aO as m,w as O,d as R,o as E,i as k,aV as N,N as z,aW as D}from"./index-BNMIKCZr.js";import F from"./column-BMEkpIFt.js";import{taskContext as M}from"./context-BU83PcAb.js";import P from"./cardBase-BI4x6AVa.js";import"./columnBase-DdbuJAvi.js";import"./type-DRAuYFMP.js";import"./chunk-KZPPZA2C-rvBpA5M9.js";import"./xmlRender-BRzwxEdt.js";import"./index-C_2RQ8Wu.js";import"./iconBase-DlBHF_7I.js";import"./mve-icon-BfNihSNC.js";import"./index-CvwBNoCX.js";import"./index-Cu7z6rlk.js";import"./index-BxY9dVzG.js";function te({tasks:C,columns:T}){const l=S(C),a=v(void 0),s=$(()=>{const r=a.get();if(r)return l.get().find(e=>e.id==r.id)}),{dragX:d,dragY:c,backHolder:p,targetHolder:g,activeColumn:w}=M.provide({tasks:l,dragData:a,dragTask:s,dragX:y(0),dragY:y(0),columns:new Map,targetHolder:h(void 0),backHolder:h(void 0),activeColumn:v(void 0)});H.div({plugin:B({shouldMeasure:a.get,direction:"x"}),className:"flex gap-6 overflow-x-auto overflow-y-hidden pb-6 flex-1 relative",children(){T.map(e=>{I(()=>{m.renderChild(F(e))})});function r(){a.set(void 0),g.set(void 0),p.set(void 0),w.set(void 0)}O(a.get,e=>{e&&(R(e.type.get,function(f){f=="cancel"?k(()=>{const o=p.get();if(o){const n=o.getBoundingClientRect();Promise.all([d.animateTo(n.x+e.x),c.animateTo(n.y+e.y)]).then(()=>{r()})}}):f=="move"&&k(()=>{const o=g.get();if(o){const n=o.element.getBoundingClientRect();Promise.all([d.animateTo(n.x+e.x),c.animateTo(n.y+e.y)]).then(()=>{const b=s(),u=o.getBeforeId(),_=l.set(function(t){t=[...t];const x={...b,type:o.type};if(N(t,i=>i.id==e.id),u){for(let i=0;i<t.length;i++)if(t[i].id==u){t.splice(i,0,x);break}}else t.push(x);return t});r(),setTimeout(()=>{_.commit()},10*1e3)})}})}),E(s,function(){m.renderChild(m.createElement(P,{selected:D,onDelete:z,getTask:s,className:"pointer-events-none opacity-90 fixed",s_zIndex:1e3,s_width:`${e.width}px`,s_height:`${e.height}px`,s_top:()=>`${c.get()-e.y}px`,s_left:()=>`${d.get()-e.x}px`,s_transformOrigin:`${e.x}px ${e.y}px`,s_rotate:()=>a.get()?.type.get()?"0deg":"-15deg"}))}))})}})}export{te as default};
