import{f as h}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as x,e as u,a1 as N,aa as X,q as Y,a5 as w,a4 as c,D as C,v as I,a6 as M,a7 as m,b as k,a8 as W,a9 as $}from"./index-C09L67qZ.js";import{m as B,f as E,a as R,b as p,t as q,e as z,d as b,c as P}from"./forceLayout-BPinnqDe.js";const S=800,D=800,H=.001;let O=0;function Q(){const l=x(u),a=x(u),o=x(void 0);N(X(document,"keydown",t=>{if(t.key=="Enter"){const e=o.get();e&&(o.set(void 0),l.set(l.get().filter(s=>s.value!=e.value)),a.set(a.get().filter(s=>s.source!=e.value&&s.target!=e.value)),g())}}));const f=Y(t=>B({nodes:(t==null?void 0:t.nodes)||u,links:(t==null?void 0:t.links)||u,fromLinks:a.get(),fromNodes:l.get(),createForceNode(e,s,r){return{index:s,x:b(e.x),y:b(e.y),z,value:e}},getNodeKey(e){return e.value},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{value:e,color:h.color.rgb(),x:0,y:0}}})),n=w(P()),F=()=>n.alpha<H,_=E(),L=R(),T=p("x"),A=p("y");function g(){const t=f();q(n,t.nodes,e=>{_(t.links,n.nDim,e),L(t.nodes,n.nDim,e),T(t.nodes,e),A(t.nodes,e)})}const d=c.svg({width:S,height:D,viewBox:`${-800/2} ${-800/2} ${S} ${D}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(t){const e={value:O++,color:h.color.rgb(),x:t.offsetX-d.clientWidth/2,y:t.offsetY-d.clientHeight/2};l.set([...l.get(),e]),o.set(e),g(),m()},children(){let t=I;C(F,e=>{if(e){t();return}t=M(()=>{g(),m()})}),k(()=>f().links,e=>c.g({stroke:"#999",strokeOpacity:.6,children(){c.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),k(()=>f().nodes,e=>c.g({stroke:"#fff",strokeWidth:1.5,onClick(s){s.stopPropagation();const r=o.get();if(s.shiftKey){if(r&&r!=e.value){if(a.get().findIndex(i=>i.source==r.value&&i.target==e.value.value)<0)a.set([...a.get(),{source:r.value,target:e.value.value}]);else{const i=a.get().slice();a.set(i)}g()}}else r==e.value?o.set(void 0):o.set(e.value)},...W(s=>{const r=d.getBoundingClientRect(),y=r.left+r.width/2,i=r.top+r.height/2;e.x.f=s.pageX-y,e.y.f=s.pageY-i,n.alphaTarget=.3,g();const K=$(v=>{v?(e.x.f=v.pageX-y,e.y.f=v.pageY-i):(e.x.f=void 0,e.y.f=void 0,n.alphaTarget=0,K())})}),children(){c.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return o.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),c.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{Q as default};
