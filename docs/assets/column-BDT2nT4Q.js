import{z as k,c as S,aO as p,aX as Y,E as R,v as x,aU as L,d as P}from"./index-D84f0y8o.js";import z from"./columnBase-2e2OBqoc.js";import{ArrayRender as K}from"./xmlRender-t-ysRih2.js";import{taskContext as O}from"./context-BfZLldrG.js";import U from"./cardBase-BXPDxfge.js";import{p as W}from"./index-BQKsZa9b.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./index-CROfFFTi.js";import"./iconBase-B9IP-JiR.js";import"./mve-icon-C6ezsOuC.js";import"./index-GzwYIlJs.js";import"./index-BHzW6WMu.js";function rt({title:B,type:a}){const{tasks:f,dragData:c,dragX:h,dragY:m,columns:v,activeColumn:u,backHolder:I,targetHolder:b,dragTask:D}=O.consume();function w(e,{whenIntoTarget:n,whenIntoDraft:o,whenNotDist:t}){let i=e.target;for(;i;){for(let[r,s]of v)if(s==i){n(r);return}i=i.parentElement}t==null||t()}const d=k(function(){return f.get().filter(e=>{if(e.type!=a)return!1;const n=c.get();return!(n&&n.type.get()!="cancel"&&e.id==n.id)})}),C=new Map,X=S(0);let E;const T=k(()=>{if(!c.get()||u.get()!=a)return-1;const n=m.get(),o=E.getBoundingClientRect(),t=X.get();if(n<o.top||n>o.bottom)return-1;const i=d();for(let r=0;r<i.length;r++){const s=i[r],g=C.get(s.id);if(!g)throw"";const l=g.offsetTop+o.top-t;if(n<l+g.clientHeight/2)return r}return i.length}),M=k(()=>{const e=T();if(e<0)return d();const n=D();if(!n)return d();const o=[...d()];return o.splice(e,0,{...n,type:a}),o});return p.createElement(z,{type:a,title:B,tasks:f.original,getTasks:d,plugin:Y(e=>{e.addEventListener("scroll",n=>{X.set(e.scrollTop)})},L({shouldMeasure(){return T()>-1},direction:"y",multi:3}),e=>{E=e,v.set(a,e),x(()=>{v.delete(a)})})},p.createElement(K,{getArray:M,getKey:e=>e.id,render:(e,n,o)=>{p.renderChild(p.createElement(U,{plugin:Y(W(n,"y"),t=>{var i;C.set(o,t),x(()=>{C.delete(o)}),P(()=>{var r;return o==((r=c.get())==null?void 0:r.id)&&u.get()==a},function(r){r&&b.set({type:a,element:t,getBeforeId(){var s;return(s=d()[T()])==null?void 0:s.id}})}),((i=c.get())==null?void 0:i.type.get())=="cancel"&&I.set(t)}),selected:()=>{var t;return((t=c.get())==null?void 0:t.id)==o},onDelete:()=>{f.original.set(f.original.get().filter(t=>t.id!=o))},className:()=>{var t;return((t=c.get())==null?void 0:t.id)==o?"opacity-0":""},getTask:e,onPointerDown:t=>{if(c.get())return;const r=t.currentTarget.getBoundingClientRect();h.set(t.pageX),m.set(t.pageY);const s={width:r.width,height:r.height,x:t.pageX-r.x,y:t.pageY-r.y,id:o,type:S(void 0)};c.set(s);let g=t;document.body.style.userSelect="none",R({onMove(l){w(l,{whenIntoTarget(H){u.set(H)}});const y=l.pageX-g.pageX,A=l.pageY-g.pageY;h.set(h.get()+y),m.set(m.get()+A),g=l},onEnd(l){document.body.style.userSelect="",w(l,{whenIntoTarget(y){u.set(y),s.type.set("move")},whenNotDist(){u.set(void 0),s.type.set("cancel")}})}})}}))}}))}export{rt as default};
