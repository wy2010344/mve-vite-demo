import{c as v,i as _,ab as j,n as L,ah as G,l as M,ak as N,f as U,ac as V,a3 as q}from"./index-DQyCy5E-.js";function B(){const u=v(0),y=v(0),E=v(!1);_(()=>E.set(!0));const k=v(`TS
类型.  
:(context: SubmitContext<FormData>) => void
表单提交时触发。其中 context.validateResult 表示校验结果，context.firstError 表示校验不通过的第一个规则提醒。context.validateResult 值为 true 表示校验通过；如果校验不通过，context.validateResult 值为校验结果列表。`),p=j({width:300,drawInfo:{},config(){return{maxLines:5,text:k.get()}},draw(e,t,f,r){V(),q(1,"black"),e.fillStyle="rgba(0, 120, 215, 0.3)";const{list:i,lineHeight:c}=I(),n=u.get(),s=y.get(),a=m();if(a)e.fillRect(a.x,a.y,2,c);else{let g=function(o,h,l){h!=l&&e.fillRect(h,o,l-h,c)},x=0,d=0,R=0,S=0;const[X,Y]=n>s?[s,n]:[n,s];let T=0,A=!0;for(let o=0;o<i.length&&A;o++){const h=i[o];for(let l=0;l<h.glyphs.length;l++){if(T==X&&(x=o,R=l),T==Y){d=o,S=l,A=!1;break}T++}}if(x==d){const o=i[x],h=o.glyphs[R].x,l=o.glyphs[S];g(o.y,h,l.x)}else{const o=i[x],h=o.glyphs[R].x,l=o.glyphs.at(-1);g(o.y,h,l.x+(l==null?void 0:l.w));for(let C=x+1;C<d;C++){const F=i[C],b=F.glyphs.at(-1);g(F.y,0,b.x+(b==null?void 0:b.w))}const D=i[d];g(D.y,0,D.glyphs[S].x)}}},onPointerDown(e){var t;u.set(P(e)),y.set(u.get()),(t=e.original.currentTarget)==null||t.addEventListener("pointermove",H)},onPointerUp(e){var t;(t=e.original.currentTarget)==null||t.removeEventListener("pointermove",H),u.get()==y.get()&&w.focus()}}),m=L(()=>{const e=u.get(),t=y.get();if(e==t)return W(e)});function W(e){const{list:t,lineHeight:f}=I();let r=0,i=0,c=!0,n=0;for(let s=0;s<t.length&&c;s++){const a=t[s],g=n+a.glyphs.length;if(n<=e&&e<g){const x=e-n;r=a.glyphs[x].x,i=a.y,c=!1}n=g}return{x:r,y:i}}let w;G(document.body,function(){M(()=>E.get()&&m(),function(){function e(){const t=w.value;console.log(t);const f=k.get(),r=f.slice(0,u.get())+t+f.slice(u.get());k.set(r),u.set(u.get()+t.length),y.set(y.get()+t.length),w.value=""}w=U.input({className:"absolute w-0 h-0",s_left(){var t;return p.target.getAbsolute("x")+(((t=m())==null?void 0:t.x)||0)+"px"},s_top(){var t;return p.target.getAbsolute("y")+(((t=m())==null?void 0:t.y)||0)+"px"},onInput(t){t.isComposing||e()},onCompositionEnd:e})})});function H(e){const t=e.clientX-p.target.getAbsolute("x"),f=e.clientY-p.target.getAbsolute("y");y.set(P({x:t,y:f}))}function P(e){const{list:t,lineHeight:f}=I();let r=0,i=!0;for(let c=0;c<t.length&&i;c++){const n=t[c];if(n.y<e.y&&e.y<n.y+f){for(let s=0;s<n.glyphs.length;s++){const a=n.glyphs[s];if(e.x<a.x+a.w/2)return r;r++}return r}r+=n.glyphs.length}return r}const I=L(()=>{const e=p.measure(),t=N();return{list:e.lines.map((r,i)=>{const c=[...r.text];let n=0;const s=i*e.lineHeight,a=[];for(let g=0;g<c.length;g++){const x=c.slice(0,g+1).join(""),d=t.measureText(x).width;a.push({char:c[g],x:n,y:s,w:d-n}),n=d}return{y:s,glyphs:a}}),lineHeight:e.lineHeight}})}export{B as default};
