import{A as k,c as X,aP as p,aY as x,G as P,v as B,aV as R,d as L}from"./index-CnmbM-dR.js";import G from"./columnBase-CfXaW5d5.js";import{ArrayRender as K}from"./xmlRender-BUbo4KVT.js";import{taskContext as V}from"./context-CUE_gZbz.js";import W from"./cardBase-Bs25AdqV.js";import{p as j}from"./index-DbV9IpBF.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./index-DxtaNgaR.js";import"./iconBase-BXAUkN_4.js";import"./mve-icon-Tt48vH7k.js";import"./index-DjZGZQsH.js";import"./index-BHzW6WMu.js";function rt({title:E,type:a}){const{tasks:f,dragData:c,dragX:h,dragY:m,columns:v,activeColumn:u,backHolder:I,targetHolder:b,dragTask:A}=V.consume();function w(e,{whenIntoTarget:n,whenIntoDraft:o,whenNotDist:t}){let i=e.target;for(;i;){for(let[r,s]of v)if(s==i){n(r);return}i=i.parentElement}t==null||t()}const d=k(function(){return f.get().filter(e=>{if(e.type!=a)return!1;const n=c.get();return!(n&&n.type.get()!="cancel"&&e.id==n.id)})}),C=new Map,Y=X(0);let S;const T=k(()=>{if(!c.get()||u.get()!=a)return-1;const n=m.get(),o=S.getBoundingClientRect(),t=Y.get();if(n<o.top||n>o.bottom)return-1;const i=d();for(let r=0;r<i.length;r++){const s=i[r],g=C.get(s.id);if(!g)throw"";const l=g.offsetTop+o.top-t;if(n<l+g.clientHeight/2)return r}return i.length}),D=k(()=>{const e=T();if(e<0)return d();const n=A();if(!n)return d();const o=[...d()];return o.splice(e,0,{...n,type:a}),o});return p.createElement(G,{type:a,title:E,tasks:f.original,getTasks:d,plugin:x(e=>{e.addEventListener("scroll",n=>{Y.set(e.scrollTop)})},R({shouldMeasure(){return T()>-1},direction:"y",multi:3}),e=>{S=e,v.set(a,e),B(()=>{v.delete(a)})})},p.createElement(K,{getArray:D,getKey:e=>e.id,render:(e,n,o)=>{p.renderChild(p.createElement(W,{plugin:x(j(n,"y"),t=>{var i;C.set(o,t),B(()=>{C.delete(o)}),L(()=>{var r;return o==((r=c.get())==null?void 0:r.id)&&u.get()==a},function(r){r&&b.set({type:a,element:t,getBeforeId(){var s;return(s=d()[T()])==null?void 0:s.id}})}),((i=c.get())==null?void 0:i.type.get())=="cancel"&&I.set(t)}),selected:()=>{var t;return((t=c.get())==null?void 0:t.id)==o},onDelete:()=>{f.original.set(f.original.get().filter(t=>t.id!=o))},className:()=>{var t;return((t=c.get())==null?void 0:t.id)==o?"opacity-0":""},getTask:e,onPointerDown:t=>{if(c.get())return;const r=t.currentTarget.getBoundingClientRect();h.set(t.pageX),m.set(t.pageY);const s={width:r.width,height:r.height,x:t.pageX-r.x,y:t.pageY-r.y,id:o,type:X(void 0)};c.set(s);let g=t;document.body.style.userSelect="none",P({onMove(l){w(l,{whenIntoTarget(H){u.set(H)}});const y=l.pageX-g.pageX,M=l.pageY-g.pageY;h.set(h.get()+y),m.set(m.get()+M),g=l},onEnd(l){document.body.style.userSelect="",w(l,{whenIntoTarget(y){u.set(y),s.type.set("move")},whenNotDist(){u.set(void 0),s.type.set("cancel")}})}})}}))}}))}export{rt as default};
