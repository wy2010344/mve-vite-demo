import{f as m}from"./chunk-KZPPZA2C-rvBpA5M9.js";import{v as K,V as N,z as X,c as x,e as d,ar as Y,j as a,d as $,b as p,aq as w,av as C,g as I,as as M}from"./index-B26XVUiJ.js";import{m as W,f as z,a as B,b,e as E,d as S,i as R,t as q}from"./forceLayout-CjNn77uU.js";const h=800,k=800,P=.001;let j=0;function G(){const n=x(d),r=x(d),o=x(void 0);K(N(document,"keydown",e=>{if(e.key=="Enter"){const t=o.get();t&&(o.set(void 0),n.set(n.get().filter(s=>s.value!=t.value)),r.set(r.get().filter(s=>s.source!=t.value&&s.target!=t.value)),c())}}));const u=2,f=X(e=>W({nodes:e?.nodes||d,links:e?.links||d,fromLinks:r.get(),fromNodes:n.get(),createForceNode(t,s,g){return{index:s,x:S(t.x),y:S(t.y),z:E,value:t}},getNodeKey(t){return t.value},getSorceKey(t){return t.source},getTargetKey(t){return t.target},createFromKey(t){return{value:t,color:m.color.rgb(),x:0,y:0}}})),l=Y(R()),D=()=>l.alpha<P,F=z(),_=B(),L=b("x"),T=b("y");function c(){const e=f();q(u,l,e.nodes,t=>{F(e.links,u,t),_(e.nodes,u,t),L(e.nodes,t),T(e.nodes,t)})}const y=a.svg({width:h,height:k,viewBox:`${-h/2} ${-k/2} ${h} ${k}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(e){const t={value:j++,color:m.color.rgb(),x:e.offsetX-y.clientWidth/2,y:e.offsetY-y.clientHeight/2};n.set([...n.get(),t]),o.set(t),c(),C()},children(){$(D,function(e){if(!e)return I(()=>{c()})}),p(()=>f().links,e=>a.g({stroke:"#999",strokeOpacity:.6,children(){a.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),p(()=>f().nodes,e=>a.g({stroke:"#fff",strokeWidth:1.5,onClick(t){t.stopPropagation();const s=o.get();if(t.shiftKey){if(s&&s!=e.value){if(r.get().findIndex(i=>i.source==s.value&&i.target==e.value.value)<0)r.set([...r.get(),{source:s.value,target:e.value.value}]);else{const i=r.get().slice();r.set(i)}c()}}else s==e.value?o.set(void 0):o.set(e.value)},...w(t=>{const s=y.getBoundingClientRect(),g=s.left+s.width/2,i=s.top+s.height/2;e.x.f=t.pageX-g,e.y.f=t.pageY-i,l.alphaTarget=.3,c();const A=M(v=>{v?(e.x.f=v.pageX-g,e.y.f=v.pageY-i):(e.x.f=void 0,e.y.f=void 0,l.alphaTarget=0,A())})}),children(){a.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return o.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),a.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:`${e.value.value}`})}}))}})}export{G as default};
