import{c as A,x as q,j as D,b as L,ar as Q,l as ee,f as te,K as se,y as oe,as as ne,A as re,e as W,d as F,g as ae,at as j,v as P,V as U,G as ie,au as H,av as ce,m as de,p as ge,t as fe}from"./index-CnmbM-dR.js";import le from"./graph-BB3NgaJ2.js";import{o as ue}from"./transform-W4V8p7Sk.js";import{f as he,a as pe,b as G,i as me,m as ye,c as ve,t as xe,e as we,d as be}from"./forceLayout-BYmRYkBU.js";import{g as ke,r as Se,T as Te,h as De}from"./hookThreeView-McNS8_S4.js";import{b as Le}from"./index-DbV9IpBF.js";import{c as ze}from"./category10-CXXk8p4X.js";import{C as Ce,A as Me,D as I,S as Ae,R as Fe,V as Be,M as Ne,a as Re,L as Xe,b as Z,B as Ye,c as _e,d as Pe,e as Ge}from"./three.core-Bu5rU7E4.js";import"./three.module-b3oiPfzz.js";import"./index-DjZGZQsH.js";import"./iconBase-BXAUkN_4.js";import"./index-BHzW6WMu.js";const b=800,k=800,Oe=.001,Ve=["2D-svg","2D-canvas","3D"];function tt(){const z=A("2D-canvas");Le({options:Ve,value:z.get,onChange:z.set,renderChild(h){oe.span().renderTextContent(h)}});const m=A(le),x=ue(ze),S=he(),w=pe(),y=G("x"),B=G("y");function N(h,f){const l=ne(me()),p=()=>l.alpha<Oe,g=re(t=>ye({nodes:(t==null?void 0:t.nodes)||W,links:(t==null?void 0:t.links)||W,fromLinks:m.get().links,fromNodes:m.get().nodes,createForceNode(s,a,c){return ve(s,h,a,be,we)},getNodeKey(s){return s.id},getSorceKey(s){return s.source},getTargetKey(s){return s.target},createFromKey(s){return{id:s,group:"not-found"}}}));function e(){const t=g();xe(h,l,t.nodes,s=>{S(t.links,h,s),w(t.nodes,h,s),f(t,s)})}return F(p,function(t){if(!t)return ae(()=>{e()})}),{config:l,getNodesAndLinks:g,didTick:e}}q(z.get,function(h){if(h=="2D-svg"){const{getNodesAndLinks:f,didTick:l,config:p}=N(2,(e,t)=>{y(e.nodes,t),B(e.nodes,t)}),g=D.svg({width:b,height:k,viewBox:`${-800/2} ${-800/2} ${b} ${k}`,s_maxWidth:"100%",s_height:"auto",children(){L(()=>f().links,e=>D.g({stroke:"#999",strokeOpacity:.6,children(){D.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:Math.sqrt(e.value.value)})}})),L(()=>f().nodes,e=>D.g({stroke:"#fff",strokeWidth:1.5,children(){D.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,fill:x(e.value.group),...Q(t=>{const s=g.getBoundingClientRect(),a=s.left+s.width/2,c=s.top+s.height/2;e.x.f=t.pageX-a,e.y.f=t.pageY-c,p.alphaTarget=.3,l();const u=j(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,p.alphaTarget=0,u())})})})}}))}})}else if(h=="2D-canvas"){const{getNodesAndLinks:f,didTick:l,config:p}=N(2,(g,e)=>{y(g.nodes,e),B(g.nodes,e)});ee({width:b,height:k},function(g){de({x:0,y:0,draw(e){e.strokeStyle="#999",f().links.forEach(t=>{e.beginPath(),e.moveTo(t.source.x.d,t.source.y.d),e.lineTo(t.target.x.d,t.target.y.d),e.lineWidth=Math.sqrt(t.value.value),e.stroke()})}}),L(()=>f().nodes,function(e){ge({x:e.x.dSignal.get,y:e.y.dSignal.get,width:0,height:0,draw(t,s){s.ellipse(0,0,5,5,0,0,360),fe(x(e.value.group))},onPointerDown({original:t}){const s=g.canvas.getBoundingClientRect(),a=s.left+s.width/2,c=s.top+s.height/2;e.x.f=t.pageX-a,e.y.f=t.pageY-c,p.alphaTarget=.3,l();const u=j(d=>{d?(e.x.f=d.pageX-a,e.y.f=d.pageY-c):(e.x.f=void 0,e.y.f=void 0,p.alphaTarget=0,u())})}})})},{beforeDraw(g){g.translate(b/2,k/2)}})}else if(h=="3D"){const f=A(void 0),l=A(void 0);q(f.get,function(a){if(!a)return;const c=a.userData;te.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){var u;return(((u=l.get())==null?void 0:u.clientX)||0)+15+"px"},s_top(){var u;return(((u=l.get())==null?void 0:u.clientY)||0)+15+"px"},children(){se`${c.value.group}--${c.value.citing_patents_count||""}`}})});const p=G("z"),{getNodesAndLinks:g,didTick:e,config:t}=N(3,(a,c)=>{y(a.nodes,c),B(a.nodes,c),p(a.nodes,c)}),s=ke(b,k);s.position.z=500,Se({camera:s,width:b,height:k,render(a){const{renderer:c}=Te.consume();a.background=new Ce(16119802);const u=new Me(16777215,.4);a.add(u);const d=new I(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,a.add(d);const O=new I(16777215,.3);O.position.set(-5,5,5),a.add(O);const V=De(),J=new Ae(5,32,32);function R(n,i){n.x=i.x.d,n.y=i.y.d,n.z=i.z.d}const T=new Fe,C=new Be,X=[],M=c.domElement;function $(n,i,o){const r=i.clientX-o.left,v=i.clientY-o.top;n.x=r/o.width*2-1,n.y=-(v/o.height*2-1)}function E(n,i){$(C,n,i),T.setFromCamera(C,s);const o=T.intersectObjects(X);if(o.length>0)return o[0].object}P(U(M,"pointermove",n=>{const i=M.getBoundingClientRect(),o=E(n,i);o?(f.set(o),l.set(n)):f.set(void 0)})),P(U(M,"pointerdown",n=>{const i=M.getBoundingClientRect(),o=E(n,i);if(o){V.enabled=!1;const r=o.userData;r.z.f=r.z.d,t.alphaTarget=.3,e(),ie({onMove(v){$(C,v,i),T.setFromCamera(C,s);const Y=T.ray.direction,_=T.ray.origin,K=(r.z.f-_.z)/Y.z;r.x.f=_.x+Y.x*K,r.y.f=_.y+Y.y*K},onEnd(v){r.x.f=void 0,r.y.f=void 0,t.alphaTarget=0,V.enabled=!0}})}})),L(()=>g().nodes,n=>{const i=x(n.value.group),o=new Ne({color:i,specular:1118481,shininess:50,bumpMap:$e(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Re(J,o);H(r),r.userData=n,X.push(r),P(()=>{ce(X,r)}),F(()=>{f.get()==r?o.emissive.setHex(3355443):o.emissive.set(i)}),F(()=>{R(r.position,n)})}),L(()=>g().links,n=>{const i=new Xe({color:0,transparent:!0,opacity:.3}),o=[];o.push(new Z),o.push(new Z);const r=new Ye().setFromPoints(o),v=new _e(r,i);H(v),F(()=>{R(o[0],n.source),R(o[1],n.target),v.geometry=r.setFromPoints(o)})})}})}})}function $e(){const m=new Uint8Array(16384);for(let S=0;S<64*64;S++){const w=S*4,y=Math.random()*255;m[w]=y,m[w+1]=y,m[w+2]=y,m[w+3]=255}const x=new Pe(m,64,64,Ge);return x.needsUpdate=!0,x}export{tt as default};
