import{e as I,g as k}from"./index-CDh5263u.js";import{c as n,f as x,E as Y,aP as D,b as E,aQ as M,w as X,e as B,K as L}from"./index-BeB-7kZt.js";import{Button as O}from"./button-C4yMbjGs.js";import{context as S}from"./context-CHaqSROq.js";import{Edge as P}from"./edge-DFhKtg0f.js";import{createNumberNodeType as $}from"./node-BIZv5RZV.js";import"./index-DWYOOuKM.js";import"./iconBase-loNxg2Lh.js";import"./index-BxY9dVzG.js";import"./index-BhtCkcjH.js";import"./mve-icon-BrTsJoJp.js";import"./bezier-edge-C8CSNjLG.js";import"./types-BBEhAH_j.js";function J(){const w=I(C),y=n(!1),m=n(0),u=n(0),p=n(1),f=n(B),d=n(void 0),l=n(void 0),v=n(void 0);S.provide({scale:p,selectedNode:d,onPointerDownOutput(r,t,e){const o=t.type.outputLocation(e);if(!o)throw"";const a=p.get(),s=N.getBoundingClientRect(),{hoverInto:g,toPointX:i,toPointY:b}=v.set({location:o,fromNode:t,fromKey:e,toPointX:n((r.pageX-s.left-m.get())/a),toPointY:n((r.pageY-s.top-u.get())/a),hoverInto:n(void 0)});Y({onMove(h){const c=p.get();i.set(i.get()+(h.pageX-r.pageX)/c),b.set(b.get()+(h.pageY-r.pageY)/c),r=h},onEnd(h){const c=g.get();c&&(c.node.args.inputs.set({...c.node.args.inputs.get(),[c.key]:{fromKey:e,fromNode:t}}),l.set(c)),v.set(void 0)}})},onPointerEnterInput(r,t,e){const o=v.get();o&&o.hoverInto.set({key:e,node:t})},onPointerLeaveInput(r,t,e){const o=v.get();o&&o.hoverInto.set(void 0)}});const N=x.div({className:w("wrapper",{className:"inset-10 absolute  overflow-hidden"}),onPointerDown(r){d.set(void 0),y.set(!0),Y({onMove(t){const e=t.pageX-r.pageX,o=t.pageY-r.pageY;m.set(m.get()+e),u.set(u.get()+o),r=t},onEnd(t){y.set(!1)}})},children(r){r.addEventListener("wheel",t=>{t.preventDefault();const e=r.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top,s=p.get(),g=p.set(D(1,p.get()+t.deltaY*-.005,2)),i=(o-m.get())/s,b=(a-u.get())/s;m.set(o-i*g),u.set(a-b*g)}),O({showDelete(){return d.get()||l.get()},onClickAdd(t,e){const o={id:`node_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,x:n(Math.random()*window.innerWidth),y:n(Math.random()*window.innerHeight),data:{numberInputs:n(t),numberOutputs:n(e)},inputs:n(L)};d.set(o),f.set(f.get().concat({args:o,type:$(o)}))},onClickDelete(){d.get()&&(f.set(f.get().filter(e=>e.args!=d.get())),d.set(void 0));const t=l.get();if(t){const e=t.node.args.inputs.set({...t.node.args.inputs.get()});delete e[t.key]}}}),x.div({className(){return w("main",{dragging:y.get()})},s_transform(){return`translate(${m.get()}px,${u.get()}px) scale(${p.get()})`},children(){E(f.get,function(t){t.type.render(t),M(t.args.inputs.get,function(e,o){X(o,function(a){const s=t.type.inputLocation(e),g=a.fromNode.type.outputLocation(a.fromKey);s&&g&&P({fromX:s.x,fromY:s.y,toX:g.x,toY:g.y,selected(){const i=l.get();return i&&i.node==t&&i.key==e},onPointerDown(i){l.set({node:t,key:e})}})})})}),X(v.get,function(t){t&&P({isNew:!0,toX:t.location.x,toY:t.location.y,fromX:t.toPointX.get,fromY:t.toPointY.get})})}})}})}const C=k(w=>({wrapper:{},main:{base:{position:"absolute",transformOrigin:"0 0",width:"100%",height:"100%",backgroundSize:"30px 30px",backgroundImage:"radial-gradient(circle, #b8b8b8bf 1px,rgba(0, 0, 0, 0) 1px )"},variants:{dragging:{true:{cursor:"grab"},false:{cursor:"grabbing"}}}}}),{wrapper:{},main:{}});export{J as default};
