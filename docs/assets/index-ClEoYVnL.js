import{c as C,k as E,an as S,b as M,ar as Z,f as Q,z as ee,d as te,aq as se,n as ne,e as K,h as D,J as oe,at as re,j as X,al as W,w as ie,b4 as U,bk as ae}from"./index-DQyCy5E-.js";import ce from"./graph-BB3NgaJ2.js";import{c as de,o as ge}from"./transform-W4V8p7Sk.js";import{f as fe,a as ue,b as Y,i as le,m as pe,t as he,d as me,e as ye,c as xe}from"./forceLayout-CAGwU0f4.js";import{g as be,r as ve,T as we,h as ke}from"./hookThreeView-Bv5QKT4B.js";import{b as Se}from"./index-DkPl-7LE.js";import{C as ze,cb as Te,cc as H,cp as Le,cq as Ce,h as Me,ci as De,ap as Ae,cr as Fe,V as I,an as Be,cs as Ne,ct as _e,j as Re}from"./three.core-CVFNDdqD.js";import"./three.module-iyRXV4cU.js";import"./index-BBRnVKPH.js";import"./iconBase-CeRrWgC7.js";import"./index-BHzW6WMu.js";const Xe=de("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),A=800,F=800,Ye=.001,Oe=["2D","3D"];function Je(){const z=C("2D");Se({options:Oe,value:z.get,onChange:z.set,renderChild(g){te.span().renderTextContent(g)}});const p=C(ce),v=ge(Xe),w=fe(),y=ue(),x=Y("x"),O=Y("y");function P(g,f){const u=se(le()),b=()=>u.alpha<Ye,h=ne(n=>pe({nodes:(n==null?void 0:n.nodes)||K,links:(n==null?void 0:n.links)||K,fromLinks:p.get().links,fromNodes:p.get().nodes,createForceNode(s,a,c){return me(s,g,a,xe,ye)},getNodeKey(s){return s.id},getSorceKey(s){return s.source},getTargetKey(s){return s.target},createFromKey(s){return{id:s,group:"not-found"}}}));function t(){const n=h();he(g,u,n.nodes,s=>{w(n.links,g,s),y(n.nodes,g,s),f(n,s)})}return D(b,function(n){if(!n)return oe(()=>{t()})}),{config:u,getNodesAndLinks:h,didTick:t}}E(z.get,function(g){if(g=="2D"){const{getNodesAndLinks:f,didTick:u,config:b}=P(2,(t,n)=>{x(t.nodes,n),O(t.nodes,n)}),h=S.svg({width:A,height:F,viewBox:`${-800/2} ${-800/2} ${A} ${F}`,s_maxWidth:"100%",s_height:"auto",children(){M(()=>f().links,t=>S.g({stroke:"#999",strokeOpacity:.6,children(){S.line({x1:t.source.x.dSignal.get,y1:t.source.y.dSignal.get,x2:t.target.x.dSignal.get,y2:t.target.y.dSignal.get,strokeWidth:Math.sqrt(t.value.value)})}})),M(()=>f().nodes,t=>S.g({stroke:"#fff",strokeWidth:1.5,children(){S.circle({r:5,cx:t.x.dSignal.get,cy:t.y.dSignal.get,fill:v(t.value.group),...Z(n=>{const s=h.getBoundingClientRect(),a=s.left+s.width/2,c=s.top+s.height/2;t.x.f=n.pageX-a,t.y.f=n.pageY-c,b.alphaTarget=.3,u();const l=re(d=>{d?(t.x.f=d.pageX-a,t.y.f=d.pageY-c):(t.x.f=void 0,t.y.f=void 0,b.alphaTarget=0,l())})})})}}))}})}else if(g=="3D"){const f=C(void 0),u=C(void 0);E(f.get,function(a){if(!a)return;const c=a.userData;Q.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){var l;return(((l=u.get())==null?void 0:l.clientX)||0)+15+"px"},s_top(){var l;return(((l=u.get())==null?void 0:l.clientY)||0)+15+"px"},children(){ee`${c.value.group}--${c.value.citing_patents_count||""}`}})});const b=Y("z"),{getNodesAndLinks:h,didTick:t,config:n}=P(3,(a,c)=>{x(a.nodes,c),O(a.nodes,c),b(a.nodes,c)}),s=be(A,F);s.position.z=500,ve({camera:s,width:A,height:F,render(a){const{renderer:c}=we.consume();a.background=new ze(16119802);const l=new Te(16777215,.4);a.add(l);const d=new H(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,a.add(d);const $=new H(16777215,.3);$.position.set(-5,5,5),a.add($);const q=ke(),J=new Le(5,32,32);function B(o,i){o.x=i.x.d,o.y=i.y.d,o.z=i.z.d}const k=new Ce,T=new Me,N=[],L=c.domElement;function G(o,i,e){const r=i.clientX-e.left,m=i.clientY-e.top;o.x=r/e.width*2-1,o.y=-(m/e.height*2-1)}function V(o,i){G(T,o,i),k.setFromCamera(T,s);const e=k.intersectObjects(N);if(e.length>0)return e[0].object}X(W(L,"pointermove",o=>{const i=L.getBoundingClientRect(),e=V(o,i);e?(f.set(e),u.set(o)):f.set(void 0)})),X(W(L,"pointerdown",o=>{const i=L.getBoundingClientRect(),e=V(o,i);if(e){q.enabled=!1;const r=e.userData;r.z.f=r.z.d,n.alphaTarget=.3,t(),ie({onMove(m){G(T,m,i),k.setFromCamera(T,s);const _=k.ray.direction,R=k.ray.origin,j=(r.z.f-R.z)/_.z;r.x.f=R.x+_.x*j,r.y.f=R.y+_.y*j},onEnd(m){r.x.f=void 0,r.y.f=void 0,n.alphaTarget=0,q.enabled=!0}})}})),M(()=>h().nodes,o=>{const i=v(o.value.group),e=new De({color:i,specular:1118481,shininess:50,bumpMap:Pe(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Ae(J,e);U(r),r.userData=o,N.push(r),X(()=>{ae(N,r)}),D(()=>{f.get()==r?e.emissive.setHex(3355443):e.emissive.set(i)}),D(()=>{B(r.position,o)})}),M(()=>h().links,o=>{const i=new Fe({color:0,transparent:!0,opacity:.3}),e=[];e.push(new I),e.push(new I);const r=new Be().setFromPoints(e),m=new Ne(r,i);U(m),D(()=>{B(e[0],o.source),B(e[1],o.target),m.geometry=r.setFromPoints(e)})})}})}})}function Pe(){const p=new Uint8Array(16384);for(let w=0;w<64*64;w++){const y=w*4,x=Math.random()*255;p[y]=x,p[y+1]=x,p[y+2]=x,p[y+3]=255}const v=new _e(p,64,64,Re);return v.needsUpdate=!0,v}export{Je as default};
