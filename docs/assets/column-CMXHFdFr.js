import{n as k,c as Y,aM as p,aV as x,w as R,j as B,aS as L,h as P}from"./index--sZwA4wO.js";import j from"./columnBase-DTgzh8u0.js";import{ArrayRender as K}from"./xmlRender-C-x1Wy3_.js";import{taskContext as V}from"./context-DTzJ9m_p.js";import W from"./cardBase-BU0wN0nP.js";import{p as q}from"./index-DManKRps.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./index-D43DEmZs.js";import"./iconBase-7EIOOMs7.js";import"./mve-icon-D7yDmBvI.js";import"./index-CMyapRKq.js";import"./index-BHzW6WMu.js";function rt({title:E,type:a}){const{tasks:f,dragData:c,dragX:h,dragY:m,columns:C,activeColumn:u,backHolder:I,targetHolder:M,dragTask:b}=V.consume();function w(e,{whenIntoTarget:n,whenIntoDraft:o,whenNotDist:t}){let i=e.target;for(;i;){for(let[r,s]of C)if(s==i){n(r);return}i=i.parentElement}t==null||t()}const d=k(function(){return f.get().filter(e=>{if(e.type!=a)return!1;const n=c.get();return!(n&&n.type.get()!="cancel"&&e.id==n.id)})}),T=new Map,S=Y(0);let X;const v=k(()=>{if(!c.get()||u.get()!=a)return-1;const n=m.get(),o=X.getBoundingClientRect(),t=S.get();if(n<o.top||n>o.bottom)return-1;const i=d();for(let r=0;r<i.length;r++){const s=i[r],g=T.get(s.id);if(!g)throw"";const l=g.offsetTop+o.top-t;if(n<l+g.clientHeight/2)return r}return i.length}),D=k(()=>{const e=v();if(e<0)return d();const n=b();if(!n)return d();const o=[...d()];return o.splice(e,0,{...n,type:a}),o});return p.createElement(j,{type:a,title:E,tasks:f.original,getTasks:d,plugin:x(e=>{e.addEventListener("scroll",n=>{S.set(e.scrollTop)})},L({shouldMeasure(){return v()>-1},direction:"y",multi:3}),e=>{X=e,C.set(a,e),B(()=>{C.delete(a)})})},p.createElement(K,{getArray:D,getKey:e=>e.id,render:(e,n,o)=>{p.renderChild(p.createElement(W,{plugin:x(q(n,"y"),t=>{var i;T.set(o,t),B(()=>{T.delete(o)}),P(()=>{var r;return o==((r=c.get())==null?void 0:r.id)&&u.get()==a},function(r){r&&M.set({type:a,element:t,getBeforeId(){var s;return(s=d()[v()])==null?void 0:s.id}})}),((i=c.get())==null?void 0:i.type.get())=="cancel"&&I.set(t)}),selected:()=>{var t;return((t=c.get())==null?void 0:t.id)==o},onDelete:()=>{f.original.set(f.original.get().filter(t=>t.id!=o))},className:()=>{var t;return((t=c.get())==null?void 0:t.id)==o?"opacity-0":""},getTask:e,onPointerDown:t=>{if(c.get())return;const r=t.currentTarget.getBoundingClientRect();h.set(t.pageX),m.set(t.pageY);const s={width:r.width,height:r.height,x:t.pageX-r.x,y:t.pageY-r.y,id:o,type:Y(void 0)};c.set(s);let g=t;document.body.style.userSelect="none",R({onMove(l){w(l,{whenIntoTarget(H){u.set(H)}});const y=l.pageX-g.pageX,A=l.pageY-g.pageY;h.set(h.get()+y),m.set(m.get()+A),g=l},onEnd(l){document.body.style.userSelect="",w(l,{whenIntoTarget(y){u.set(y),s.type.set("move")},whenNotDist(){u.set(void 0),s.type.set("cancel")}})}})}}))}}))}export{rt as default};
