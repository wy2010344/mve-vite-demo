import{f as h}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as x,e as u,v as K,U as N,z as X,ar as Y,j as a,d as w,b as k,aq as C,av as I,g as M,as as W}from"./index-D84f0y8o.js";import{m as $,f as z,a as B,b as m,e as E,d as p,i as R,t as q}from"./forceLayout-B04iL2ON.js";const b=800,S=800,P=.001;let j=0;function G(){const n=x(u),r=x(u),i=x(void 0);K(N(document,"keydown",e=>{if(e.key=="Enter"){const t=i.get();t&&(i.set(void 0),n.set(n.get().filter(s=>s.value!=t.value)),r.set(r.get().filter(s=>s.source!=t.value&&s.target!=t.value)),c())}}));const f=2,d=X(e=>$({nodes:(e==null?void 0:e.nodes)||u,links:(e==null?void 0:e.links)||u,fromLinks:r.get(),fromNodes:n.get(),createForceNode(t,s,l){return{index:s,x:p(t.x),y:p(t.y),z:E,value:t}},getNodeKey(t){return t.value},getSorceKey(t){return t.source},getTargetKey(t){return t.target},createFromKey(t){return{value:t,color:h.color.rgb(),x:0,y:0}}})),g=Y(R()),D=()=>g.alpha<P,F=z(),_=B(),L=m("x"),T=m("y");function c(){const e=d();q(f,g,e.nodes,t=>{F(e.links,f,t),_(e.nodes,f,t),L(e.nodes,t),T(e.nodes,t)})}const y=a.svg({width:b,height:S,viewBox:`${-800/2} ${-800/2} ${b} ${S}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(e){const t={value:j++,color:h.color.rgb(),x:e.offsetX-y.clientWidth/2,y:e.offsetY-y.clientHeight/2};n.set([...n.get(),t]),i.set(t),c(),I()},children(){w(D,function(e){if(!e)return M(()=>{c()})}),k(()=>d().links,e=>a.g({stroke:"#999",strokeOpacity:.6,children(){a.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),k(()=>d().nodes,e=>a.g({stroke:"#fff",strokeWidth:1.5,onClick(t){t.stopPropagation();const s=i.get();if(t.shiftKey){if(s&&s!=e.value){if(r.get().findIndex(o=>o.source==s.value&&o.target==e.value.value)<0)r.set([...r.get(),{source:s.value,target:e.value.value}]);else{const o=r.get().slice();r.set(o)}c()}}else s==e.value?i.set(void 0):i.set(e.value)},...C(t=>{const s=y.getBoundingClientRect(),l=s.left+s.width/2,o=s.top+s.height/2;e.x.f=t.pageX-l,e.y.f=t.pageY-o,g.alphaTarget=.3,c();const A=W(v=>{v?(e.x.f=v.pageX-l,e.y.f=v.pageY-o):(e.x.f=void 0,e.y.f=void 0,g.alphaTarget=0,A())})}),children(){a.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return i.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),a.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{G as default};
