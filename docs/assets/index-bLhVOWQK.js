import{e as I,j as k}from"./index-DTVsSBOz.js";import{c as n,e as D,f as x,t as Y,ar as M,r as B,as as E,l as X,x as L}from"./index-Dxu4lnfn.js";import{Button as O}from"./button-ukuqCbsQ.js";import{context as S}from"./context-6Bmj5sbO.js";import{Edge as P}from"./edge-DWh_NSmG.js";import{createNumberNodeType as $}from"./node-OogU6mWX.js";import"./index-CT0uQ99y.js";import"./canvasRender-CK3mhhFQ.js";import"./_commonjsHelpers-CqkleIqs.js";import"./index-D2NKKKQE.js";import"./iconBase-BD6ICo6R.js";import"./index-BxY9dVzG.js";import"./index-DGGGthP9.js";import"./mve-icon-Bb-GIgrm.js";import"./bezier-edge-C8CSNjLG.js";import"./types-BBEhAH_j.js";function Z(){const y=I(C),w=n(!1),m=n(0),u=n(0),p=n(1),f=n(D),d=n(void 0),l=n(void 0),v=n(void 0);S.provide({scale:p,selectedNode:d,onPointerDownOutput(r,t,e){const o=t.type.outputLocation(e);if(!o)throw"";const a=p.get(),s=N.getBoundingClientRect(),{hoverInto:c,toPointX:i,toPointY:b}=v.set({location:o,fromNode:t,fromKey:e,toPointX:n((r.pageX-s.left-m.get())/a),toPointY:n((r.pageY-s.top-u.get())/a),hoverInto:n(void 0)});Y({onMove(h){const g=p.get();i.set(i.get()+(h.pageX-r.pageX)/g),b.set(b.get()+(h.pageY-r.pageY)/g),r=h},onEnd(h){const g=c.get();g&&(g.node.args.inputs.set({...g.node.args.inputs.get(),[g.key]:{fromKey:e,fromNode:t}}),l.set(g)),v.set(void 0)}})},onPointerEnterInput(r,t,e){const o=v.get();o&&o.hoverInto.set({key:e,node:t})},onPointerLeaveInput(r,t,e){const o=v.get();o&&o.hoverInto.set(void 0)}});const N=x.div({className:y("wrapper",{className:"inset-10 absolute  overflow-hidden"}),onPointerDown(r){d.set(void 0),w.set(!0),Y({onMove(t){const e=t.pageX-r.pageX,o=t.pageY-r.pageY;m.set(m.get()+e),u.set(u.get()+o),r=t},onEnd(t){w.set(!1)}})},children(r){r.addEventListener("wheel",t=>{t.preventDefault();const e=r.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top,s=p.get(),c=p.set(M(1,p.get()+t.deltaY*-.005,2)),i=(o-m.get())/s,b=(a-u.get())/s;m.set(o-i*c),u.set(a-b*c)}),O({showDelete(){return d.get()||l.get()},onClickAdd(t,e){const o={id:`node_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,x:n(Math.random()*window.innerWidth),y:n(Math.random()*window.innerHeight),data:{numberInputs:n(t),numberOutputs:n(e)},inputs:n(L)};d.set(o),f.set(f.get().concat({args:o,type:$(o)}))},onClickDelete(){d.get()&&(f.set(f.get().filter(e=>e.args!=d.get())),d.set(void 0));const t=l.get();if(t){const e=t.node.args.inputs.set({...t.node.args.inputs.get()});delete e[t.key]}}}),x.div({className(){return y("main",{dragging:w.get()})},s_transform(){return`translate(${m.get()}px,${u.get()}px) scale(${p.get()})`},children(){B(f.get,function(t){t.type.render(t),E(t.args.inputs.get,function(e,o){X(o,function(a){const s=t.type.inputLocation(e),c=a.fromNode.type.outputLocation(a.fromKey);s&&c&&P({fromX:s.x,fromY:s.y,toX:c.x,toY:c.y,selected(){const i=l.get();return i&&i.node==t&&i.key==e},onPointerDown(i){l.set({node:t,key:e})}})})})}),X(v.get,function(t){t&&P({isNew:!0,toX:t.location.x,toY:t.location.y,fromX:t.toPointX.get,fromY:t.toPointY.get})})}})}})}const C=k(y=>({wrapper:{},main:{base:{position:"absolute",transformOrigin:"0 0",width:"100%",height:"100%",backgroundSize:"30px 30px",backgroundImage:"radial-gradient(circle, #b8b8b8bf 1px,rgba(0, 0, 0, 0) 1px )"},variants:{dragging:{true:{cursor:"grab"},false:{cursor:"grabbing"}}}}}),{wrapper:{},main:{}});export{Z as default};
