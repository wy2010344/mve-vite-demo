import{f as h}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as x,e as u,j as K,al as N,n as X,aq as Y,an as o,h as w,b as k,ar as C,as as I,J as M,at as W}from"./index-DQyCy5E-.js";import{m as $,f as B,a as E,b as m,t as R,i as q,e as z,c as p}from"./forceLayout-CAGwU0f4.js";const b=800,S=800,P=.001;let j=0;function G(){const n=x(u),r=x(u),a=x(void 0);K(N(document,"keydown",e=>{if(e.key=="Enter"){const t=a.get();t&&(a.set(void 0),n.set(n.get().filter(s=>s.value!=t.value)),r.set(r.get().filter(s=>s.source!=t.value&&s.target!=t.value)),c())}}));const f=2,d=X(e=>$({nodes:(e==null?void 0:e.nodes)||u,links:(e==null?void 0:e.links)||u,fromLinks:r.get(),fromNodes:n.get(),createForceNode(t,s,g){return{index:s,x:p(t.x),y:p(t.y),z,value:t}},getNodeKey(t){return t.value},getSorceKey(t){return t.source},getTargetKey(t){return t.target},createFromKey(t){return{value:t,color:h.color.rgb(),x:0,y:0}}})),l=Y(q()),D=()=>l.alpha<P,F=B(),_=E(),L=m("x"),T=m("y");function c(){const e=d();R(f,l,e.nodes,t=>{F(e.links,f,t),_(e.nodes,f,t),L(e.nodes,t),T(e.nodes,t)})}const y=o.svg({width:b,height:S,viewBox:`${-800/2} ${-800/2} ${b} ${S}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(e){const t={value:j++,color:h.color.rgb(),x:e.offsetX-y.clientWidth/2,y:e.offsetY-y.clientHeight/2};n.set([...n.get(),t]),a.set(t),c(),I()},children(){w(D,function(e){if(!e)return M(()=>{c()})}),k(()=>d().links,e=>o.g({stroke:"#999",strokeOpacity:.6,children(){o.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),k(()=>d().nodes,e=>o.g({stroke:"#fff",strokeWidth:1.5,onClick(t){t.stopPropagation();const s=a.get();if(t.shiftKey){if(s&&s!=e.value){if(r.get().findIndex(i=>i.source==s.value&&i.target==e.value.value)<0)r.set([...r.get(),{source:s.value,target:e.value.value}]);else{const i=r.get().slice();r.set(i)}c()}}else s==e.value?a.set(void 0):a.set(e.value)},...C(t=>{const s=y.getBoundingClientRect(),g=s.left+s.width/2,i=s.top+s.height/2;e.x.f=t.pageX-g,e.y.f=t.pageY-i,l.alphaTarget=.3,c();const A=W(v=>{v?(e.x.f=v.pageX-g,e.y.f=v.pageY-i):(e.x.f=void 0,e.y.f=void 0,l.alphaTarget=0,A())})}),children(){o.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return a.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),o.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{G as default};
