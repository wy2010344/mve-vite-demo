import{f as m}from"./chunk-LSEVNFON-G8OzWBoO.js";import{c as h,e as u,i as K,ap as N,m as X,au as Y,ao as n,h as C,a as k,at as M,av as p,D as W,I as $,aw as B}from"./index-8-4crGqb.js";import{m as E,f as R,a as z,b,t as P,i as q,e as H,d as S}from"./forceLayout-BVGBbeEo.js";const D=800,F=800,O=.001;let j=0;function U(){const c=h(u),a=h(u),o=h(void 0);K(N(document,"keydown",t=>{if(t.key=="Enter"){const e=o.get();e&&(o.set(void 0),c.set(c.get().filter(s=>s.value!=e.value)),a.set(a.get().filter(s=>s.source!=e.value&&s.target!=e.value)),l())}}));const f=2,d=X(t=>E({nodes:(t==null?void 0:t.nodes)||u,links:(t==null?void 0:t.links)||u,fromLinks:a.get(),fromNodes:c.get(),createForceNode(e,s,r){return{index:s,x:S(e.x),y:S(e.y),z:H,value:e}},getNodeKey(e){return e.value},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{value:e,color:m.color.rgb(),x:0,y:0}}})),g=Y(q()),_=()=>g.alpha<O,L=R(),T=z(),w=b("x"),A=b("y");function l(){const t=d();P(f,g,t.nodes,e=>{L(t.links,f,e),T(t.nodes,f,e),w(t.nodes,e),A(t.nodes,e)})}const y=n.svg({width:D,height:F,viewBox:`${-800/2} ${-800/2} ${D} ${F}`,s_maxWidth:"100%",s_height:"auto",s_boxSizing:"content-box",s_border:"10px solid gray",s_userSelect:"none",onClick(t){const e={value:j++,color:m.color.rgb(),x:t.offsetX-y.clientWidth/2,y:t.offsetY-y.clientHeight/2};c.set([...c.get(),e]),o.set(e),l(),p()},children(){let t=W;C(_,e=>{if(e){t();return}t=$(()=>{l(),p()})}),k(()=>d().links,e=>n.g({stroke:"#999",strokeOpacity:.6,children(){n.line({x1:e.source.x.dSignal.get,y1:e.source.y.dSignal.get,x2:e.target.x.dSignal.get,y2:e.target.y.dSignal.get,strokeWidth:1})}})),k(()=>d().nodes,e=>n.g({stroke:"#fff",strokeWidth:1.5,onClick(s){s.stopPropagation();const r=o.get();if(s.shiftKey){if(r&&r!=e.value){if(a.get().findIndex(i=>i.source==r.value&&i.target==e.value.value)<0)a.set([...a.get(),{source:r.value,target:e.value.value}]);else{const i=a.get().slice();a.set(i)}l()}}else r==e.value?o.set(void 0):o.set(e.value)},...M(s=>{const r=y.getBoundingClientRect(),v=r.left+r.width/2,i=r.top+r.height/2;e.x.f=s.pageX-v,e.y.f=s.pageY-i,g.alphaTarget=.3,l();const I=B(x=>{x?(e.x.f=x.pageX-v,e.y.f=x.pageY-i):(e.x.f=void 0,e.y.f=void 0,g.alphaTarget=0,I())})}),children(){n.circle({r:5,cx:e.x.dSignal.get,cy:e.y.dSignal.get,s_outline(){return o.get()==e.value?"1px solid blue":""},s_borderRadius:"50%",fill:e.value.color}),n.text({x:e.x.dSignal.get,y:e.y.dSignal.get,stroke:e.value.color,childrenType:"text",children:e.value.value+""})}}))}})}export{U as default};
