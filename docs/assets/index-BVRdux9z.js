import{ay as q,az as j,af as W,o as J,r as Y,aA as P,aB as L,U as R,aa as $,k as N,aC as m,l as C,P as K,i as Q,aD as z,aE as ee,aF as te,aG as A,c as G,Z as ne,I as _,ad as v,aH as re,m as ie,aI as se,aJ as oe,aK as ae}from"./index-BS7P0FCu.js";import"./canvasRender-DBtyO6_b.js";function h(e,t,n){return n?function(i){return(i.keyCode==e||i.key==t)&&i.code==n}:function(i){return i.keyCode==e||i.key==t}}function B(e,t){var n=[];e.firstChild&&n.push(e.firstChild);for(var i=n.pop();i&&!t(i);)i.nextSibling&&n.push(i.nextSibling),i.firstChild&&n.push(i.firstChild),i=n.pop()}const T={DOM:{supportTouch:q(()=>"ontouchstart"in window),addEvent(e,t,n){e.addEventListener(t,n)},removeEvent(e,t,n){e.removeEventListener(t,n)},preventDefault(e){e.preventDefault()},stopPropagation(e){e.stopPropagation()},getSelectionRange(e){let{anchorNode:t,anchorOffset:n,focusNode:i,focusOffset:r}=D(e);if(!t||!i)return null;if(t==e&&i==e)return{start:n>0&&e.textContent?e.textContent.length:0,end:r>0&&e.textContent?e.textContent.length:0,dir:r>=n?"->":"<-"};if(t.nodeType===Node.ELEMENT_NODE){const o=document.createTextNode("");t.insertBefore(o,t.childNodes[n]),t=o,n=0}if(i.nodeType===Node.ELEMENT_NODE){const o=document.createTextNode("");i.insertBefore(o,i.childNodes[r]),i=o,r=0}var s={start:0,end:0};return B(e,function(o){if(o==t&&o==i)return s.start+=n,s.end+=r,s.dir=n<=r?"->":"<-",!0;if(o===t)if(s.start+=n,!s.dir)s.dir="->";else return!0;else if(o===i)if(s.end+=r,!s.dir)s.dir="<-";else return!0;o.nodeType===Node.TEXT_NODE&&(s.dir!="->"&&(s.start+=o.nodeValue.length),s.dir!="<-"&&(s.end+=o.nodeValue.length))}),e.normalize(),s},setSelectionRange(e,t){if(!t){const u=D(e);return u.removeAllRanges(),u}const n={...t},i=D(e);let r,s=0,o,a=0;if(n.dir||(n.dir="->"),n.start<0&&(n.start=0),n.end<0&&(n.end=0),n.dir=="<-"){const{start:u,end:c}=n;n.start=c,n.end=u}let l=0;return B(e,u=>{if(u.nodeType!==Node.TEXT_NODE)return;const c=(u.nodeValue||"").length;if(l+c>n.start&&(r||(r=u,s=n.start-l),l+c>n.end))return o=u,a=n.end-l,!0;l+=c}),r||(r=e,s=e.childNodes.length),o||(o=e,a=e.childNodes.length),n.dir=="<-"&&([r,s,o,a]=[o,a,r,s]),i.setBaseAndExtent(r,s,o,a),i},keyCode:{BACKSPACE:h(8,"Backspace"),ENTER:h(13,"Enter"),TAB:h(9,"Tab"),ESCAPE:h(27,"Escape"),CAPSLOCK:h(20,"CapsLock"),ARROWLEFT:h(37,"ArrowLeft"),ARROWUP:h(38,"ArrowUp"),ARROWRIGHT:h(39,"ArrowRight"),ARROWDOWN:h(40,"ArrowDown"),CONTROL:h(17,"Control"),SHIFT:h(16,"Shift"),SHIFTLEFT:h(16,"Shift","ShiftLeft"),SHIFTRIGHT:h(16,"Shift","ShiftRight"),META:h(91,"Meta"),METALEFT:h(91,"Meta","MetaLeft"),METARIGHT:h(91,"Meta","MetaRight"),ALT:h(18,"Alt"),ALTLEFT:h(18,"Alt","AltLeft"),ALTRIGHT:h(18,"Alt","AltRight"),A:h(65,"a"),Z:h(90,"z"),V:h(86,"v"),C:h(67,"c"),X:h(88,"x")}},isIE:!1},le=function(){var e={type:"FF",version:0,documentMode:""};if(!globalThis.navigator)return e;var t=navigator.userAgent,n=t.indexOf("Opera")>-1,i=t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!n,r=t.indexOf("Firefox")>-1,s=t.indexOf("Safari")>-1;if(i){T.isIE=!0;var o=new RegExp("MSIE (\\d+\\.\\d+);");o.test(t),e.type="IE",e.version=parseFloat(RegExp.$1),e.documentMode=document.documentMode}return r&&(e.type="FF"),n&&(e.type="Opera"),s&&(e.type="Safari"),e}();function ue(e){return{scrollLeft:0,scrollTop:0,range:{start:e.length,end:e.length},value:e}}function D(e){var t;return((t=e.parentNode)==null?void 0:t.nodeType)==Node.DOCUMENT_FRAGMENT_NODE?e.parentNode.getSelection():window.getSelection()}function Fe(e){return{currentIndex:0,history:[ue(e)]}}function I(e){const t=e.textContent||"",n=T.DOM.getSelectionRange(e);if(!n)throw"error-1";return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,value:t,range:n}}function ce(e){return fe(e,`
`,1)}function M(e,t){return e-t}function fe(e,t,n){const{value:i,range:r,...s}=I(e),[o,a]=[r.start,r.end].sort(M),l=i.slice(0,o),u=i.slice(a,i.length)||`
`;let c=l.length+n;return{...s,value:l+t+u,range:{start:c,end:c,dir:r.dir}}}function de(e){const{value:t,range:n,...i}=I(e),[r,s]=[n.start,n.end].sort(M),o=t.slice(0,r),a=t.slice(s,t.length);if(r!=s)return{...i,value:o+a,range:{start:r,end:r}};if(r!=0){const l=n.start-1;return{...i,value:o.slice(0,o.length-1)+a,range:{...n,start:l,end:l}}}}function he(e,t,n="	"){const{value:i,range:r,...s}=I(e),[o,a]=[r.start,r.end].sort(M);if(r.start!=r.end)if(t){const l=i.split(`
`);let u=0;const c=[];let d=!1,f=0,g=0;for(let p=0;p<l.length;p++){const x=l[p],y=u+x.length+1;u<=o&&o<y&&(d=!0,x.startsWith(n)&&u+n.length<=o&&(g=n.length)),d&&x.startsWith(n)?(f++,c.push(x.slice(n.length,x.length))):c.push(x),u<=a&&a<y&&(d=!1),u=y}return{...s,value:c.join(`
`),range:r.start>r.end?{start:r.start-f*n.length,end:r.end-g,dir:r.dir}:{start:r.start-g,end:r.end-f*n.length,dir:r.dir}}}else{const l=i.split(`
`);let u=0;const c=[];let d=!1,f=0;for(let g=0;g<l.length;g++){const p=l[g],x=u+p.length+1;u<=o&&o<x&&(d=!0),d?(f++,c.push(n+p)):c.push(p),u<=a&&a<x&&(d=!1),u=x}return{...s,value:c.join(`
`),range:r.start>r.end?{start:r.start+f*n.length,end:r.end+n.length,dir:r.dir}:{start:r.start+n.length,end:r.end+f*n.length,dir:r.dir}}}else{const l=i.slice(0,o),u=i.slice(a,i.length);if(t){if(l.endsWith(n)){const c=l.length-n.length;return{...s,value:l.slice(0,l.length-n.length)+u,range:{start:c,end:c}}}}else{const c=l.length+n.length;return{...s,value:l+n+u,range:{start:c,end:c}}}}}const be=le.type=="FF"?!0:"plaintext-only";function ge(e,t){const n=T.DOM.setSelectionRange(e,{...t.range});if(e.scrollTop=t.scrollTop,e.scrollLeft=t.scrollLeft,!n.rangeCount)return;const i=n.getRangeAt(0),r=i.endContainer==e?e.lastElementChild:i;if(r){const s=r.getBoundingClientRect();s.bottom>e.clientHeight?e.scrollTop+=s.bottom-e.clientHeight:s.top<0&&(e.scrollTop+=s.top),s.right>e.clientWidth?e.scrollLeft+=s.right-e.clientWidth:s.left<0&&(e.scrollLeft+=s.left)}}function E(e,t,n=100){const i=e.currentIndex,r=e.history.slice(0,i+1),s=r.length>2?r.at(-1):void 0;if(s&&s.range.start==s.range.end){const o=s.range.start;if(t.range.start==t.range.end){const l=t.range.start-o;if(0<=l&&t.value.startsWith(s.value)&&t.value.length-s.value.length==l)return r.pop(),r.push(t),{currentIndex:i,history:r}}}return r.push(t),r.length>n?(r.shift(),{currentIndex:i,history:r}):{currentIndex:i+1,history:r}}var pe=Object.defineProperty,xe=(e,t,n)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t,n)=>xe(e,typeof t!="symbol"?t+"":t,n);function Te(e,t){const n=document.createElement(e);return n.style.position="absolute",n.style.minWidth="0px",Ie(n,t,!1)}ee(te,e=>function(t){return Te(e,t)});function S(e){return function(t){return function(){const n=t();try{return n.getInfo(e)}catch{try{return n.parent.getChildInfo(e,n.index())}catch{return n.getInfo(e,!0)}}}}}const ye=S("x"),ve=S("y"),Ee=S("width"),Ce=S("height");function Ie(e,t,n){let i,r,s,o;function a(){return d}const l=A(t.x,a,ye),u=A(t.y,a,ve);if(t.width=="auto"){const f=G(0);s=f.get,i=f.set}else s=A(t.width,a,Ee);if(t.height=="auto"){const f=G(0);o=f.get,r=f.set}else o=A(t.height,a,Ce);const c=W();(i||r)&&C(()=>{const f=()=>{i==null||i(e.clientWidth),r==null||r(e.clientHeight),R()};f();const g=new ResizeObserver(f);g.observe(e),c(()=>{g.disconnect()})},-2);const d=new Ae(e,l,u,s,o,n,t);return z(d),!t.childrenType&&t.children?d.children=Oe(t.children,d.target,d):d.children=ne(_),C(()=>{c(v(d.x,f=>d.target.style.left=f+"px")),c(v(d.y,f=>d.target.style.top=f+"px")),i||c(v(d.width,f=>d.target.style.width=f+"px")),r||c(v(d.height,f=>d.target.style.height=f+"px"))},-1),C(()=>{function f(g,p,x){const y=arguments[3];typeof p=="function"?c(v(()=>p(d),x,g,y)):x(p,g,y)}re(e,t,f,K,_)}),d}function me(e){return e.target}class Ae{constructor(t,n,i,r,s,o,a){O(this,"display"),O(this,"children"),O(this,"parent"),O(this,"__index"),this.target=t,this.x=n,this.y=i,this.width=r,this.height=s,this.isSVG=o,this.configure=a;const l=m(a.m_display||Re);this.display=ie(()=>se(this,l))}getExt(){return this.configure}index(){return this.parent.children(),this.__index}getChildInfo(t,n){return this.display().getChildInfo(t,n)}getInfo(t,n){return this.display().getInfo(t,n)}}function Oe(e,t,n){const i=oe(e,n,r=>{r.forEach((s,o)=>{s.__index=o,s.parent&&s.parent!=n&&console.log("parent发生改变",s.parent,n),s.parent=n})});return N(i,ae(t,me)),i}const Re={getChildInfo(e,t){throw"no child location "+e},getInfo(e,t){if(t)return 0;if(e=="x"||e=="y")throw"no self location";return 0}};class w{equals(t,n){return t===n}}class F extends w{constructor(t){super(),this.input=t}getValue(){return this.input.value}setValue(t){this.input.value=t}static from(t){return new F(t)}}function U(e,t,n){const i=m(e),r=function(){t.setValue(r.value)};N(()=>{n();const s=i();s!==t.getValue()&&(r.value=s,C(r))})}function X(e="onInput",t,n,i,r,s){const[o,a]=P(),l=m(e),u=t.onInput;t.onInput=g=>{if(l()=="onInput"){const p=f.getValue();a(),i(p),u==null||u(g),R()}else u==null||u(g)};const c=t.onBlur;t.onBlur=g=>{if(l()=="onBlur"){const p=f.getValue();a(),i(p),R()}else c==null||c(g)};const d=r(t),f=s(d);return U(n,f,o),d}function Ve(e,{value:t,onValueChange:n,triggerTime:i,...r}){return X(i,r,t,n,s=>L(e,s),F.from)}class b extends w{constructor(t){super(),this.input=t}getValue(){return this.input.textContent}setValue(t){this.input.textContent=t,Z(this.input)}static from(t){return new b(t)}}class V extends w{constructor(t){super(),this.input=t}getValue(){return this.input.innerHTML}setValue(t){this.input.innerHTML=t,Z(this.input)}static from(t){return new V(t)}}function ke(e,t){const{value:n,onValueChange:i,triggerTime:r,valueType:s="text",...o}=t;return X(r,o,n,i,a=>L(e,a),s=="text"?b.from:V.from)}function Z(e){if(document.activeElement==e){const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}}class k extends w{constructor(t){super(),this.input=t}getValue(){return this.input.checked}setValue(t){this.input.checked=t}static from(t){return new k(t)}}function Ge({checked:e,onInput:t,...n}){const i=m(e),[r,s]=P(),o=L("input",{...n,onInput(a){s(),t==null||t(a),R()}});return U(i,k.from(o),r),o}function Ne(e){const t=e.currentIndex+1;return t<e.history.length?{...e,currentIndex:t}:e}function Se(e){return e.currentIndex?{...e,currentIndex:e.currentIndex-1}:e}function we(e){function t(){const n=e();return n.history[n.currentIndex]}return{current:t,renderContentEditable({noFocus:n,children:i}){const r=m(n);$(()=>t().value,function(s){const o=i(s);N(()=>{r()||C(()=>{ge(o,t())})},K)})}}}function _e(e){const{current:t,renderContentEditable:n}=we(e.get);return{current:t,renderContentEditable({noFocus:i,render:r}){n({noFocus:i,children(s){const o=r(s,{onInput(a){a.isComposing||e.set(E(e.get(),I(o)))},onCompositionEnd(){e.set(E(e.get(),I(o)))},onKeyDown(a){if(T.DOM.keyCode.TAB(a)){a.preventDefault();const l=he(o,a.shiftKey);l&&e.set(E(e.get(),l))}else if(T.DOM.keyCode.ENTER(a)){a.preventDefault();const l=ce(o);e.set(E(e.get(),l))}else if(T.DOM.keyCode.Z(a))De(a)&&(a.shiftKey?(a.preventDefault(),e.set(Ne(e.get()))):(a.preventDefault(),e.set(Se(e.get()))));else if(T.DOM.keyCode.BACKSPACE(a)){a.preventDefault();const l=de(o);l&&e.set(E(e.get(),l))}}});return o}})}}}function De(e){return e.metaKey||e.ctrlKey}function Be(e,t){J(e,(n,i)=>{let r;Y(()=>{const s=n.step();return s=="exiting"||s=="will-exiting"},()=>{var s;"node"in r?H(r,n):((s=r.call)==null||s.call(r),r.list.forEach(o=>{H(o,n)}))},()=>{r=t(n,i)})})}function H(e,t){const n=e.node.cloneNode(!0);z(n);const i=e.applyAnimate;N(t.step,r=>{r=="exiting"&&i(n)})}function He(e,t){const[n,i]=j(Q,e,t);return W()(i),n}export{ke as a,Ge as b,be as c,Be as d,He as e,_e as f,Fe as i,Ve as r};
