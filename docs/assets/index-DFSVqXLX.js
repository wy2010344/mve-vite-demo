import{aQ as S,c as h,n as H,aR as v,I as k,f as I,aS as B,aP as E,k as R,h as M,l as O,i as y,aT as P,aM as p,E as D,aU as F}from"./index--sZwA4wO.js";import N from"./column-CMXHFdFr.js";import{taskContext as X}from"./context-DTzJ9m_p.js";import Y from"./cardBase-BU0wN0nP.js";import"./columnBase-DTgzh8u0.js";import"./type-DRAuYFMP.js";import"./chunk-LSEVNFON-G8OzWBoO.js";import"./xmlRender-C-x1Wy3_.js";import"./index-D43DEmZs.js";import"./iconBase-7EIOOMs7.js";import"./mve-icon-D7yDmBvI.js";import"./index-DManKRps.js";import"./index-CMyapRKq.js";import"./index-BHzW6WMu.js";function te({tasks:C,columns:T}){const c=S(C),a=h(void 0),l=H(()=>{const r=a.get();if(r)return c.get().find(e=>e.id==r.id)}),{dragX:d,dragY:m,backHolder:g,targetHolder:f,activeColumn:b}=X.provide({tasks:c,dragData:a,dragTask:l,dragX:k(0),dragY:k(0),columns:new Map,targetHolder:v(void 0),backHolder:v(void 0),activeColumn:h(void 0)});I.div({plugin:B({shouldMeasure:a.get,direction:"x"}),className:"flex gap-6 overflow-x-auto overflow-y-hidden pb-6 flex-1 relative",children(){T.map(e=>{E(()=>{p.renderChild(N(e))})});function r(){a.set(void 0),f.set(void 0),g.set(void 0),b.set(void 0)}R(a.get,e=>{e&&(M(e.type.get,function(n){n=="cancel"?y(()=>{const o=g.get();if(o){const s=o.getBoundingClientRect();Promise.all([d.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{r()})}}):n=="move"&&y(()=>{const o=f.get();if(o){const s=o.element.getBoundingClientRect();Promise.all([d.animateTo(s.x+e.x),m.animateTo(s.y+e.y)]).then(()=>{const w=l(),u=o.getBeforeId(),_=c.set(function(t){t=[...t];const x={...w,type:o.type};if(P(t,i=>i.id==e.id),u){for(let i=0;i<t.length;i++)if(t[i].id==u){t.splice(i,0,x);break}}else t.push(x);return t});r(),setTimeout(()=>{_.commit()},10*1e3)})}})}),O(l,function(){p.renderChild(p.createElement(Y,{selected:F,onDelete:D,getTask:l,className:"pointer-events-none opacity-90 fixed",s_zIndex:1e3,s_width:e.width+"px",s_height:e.height+"px",s_top:()=>m.get()-e.y+"px",s_left:()=>d.get()-e.x+"px",s_transformOrigin:`${e.x}px ${e.y}px`,s_rotate:()=>{var n;return(n=a.get())!=null&&n.type.get()?"0deg":"-15deg"}}))}))})}})}export{te as default};
