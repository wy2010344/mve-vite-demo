import{c as D,an as J,j as q,ai as S,a as M,ao as Q,g as ee,y as te,d as se,ap as ne,m as oe,e as K,h as C,D as re,I as ae,aq as ie,ar as ce,i as X,aj as W,v as de,as as I,at as ge}from"./index-BdTCZeBf.js";import fe from"./graph-BB3NgaJ2.js";import{c as ue,o as le}from"./transform-W4V8p7Sk.js";import{f as pe,a as he,b as Y,i as me,m as ye,t as xe,c as be,e as ve,d as we}from"./forceLayout-B4nbHEBX.js";import{g as ke,r as Se,T as Te,h as ze}from"./hookThreeView-DsPlYmqB.js";import{C as Le,A as De,D as U,S as Me,R as Ce,V as Fe,M as Ae,a as Be,L as Ne,b as H,B as _e,c as Re,d as Xe,e as Ye}from"./three.core-IZwRyLr5.js";import"./three.module-EYrWAVy6.js";const Oe=ue("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),F=800,A=800,Pe=.001,$e=["2D","3D"];function Ue(){const T=D("3D");J({options:$e,value:T.get,onChange:T.set,renderChild(f){se.span().renderTextContent(f)}});const p=D(fe),v=le(Oe),w=pe(),y=he(),x=Y("x"),O=Y("y");function P(f,u){const l=ne(me()),b=()=>l.alpha<Pe,h=oe(n=>ye({nodes:(n==null?void 0:n.nodes)||K,links:(n==null?void 0:n.links)||K,fromLinks:p.get().links,fromNodes:p.get().nodes,createForceNode(e,i,g){return be(e,f,i,we,ve)},getNodeKey(e){return e.id},getSorceKey(e){return e.source},getTargetKey(e){return e.target},createFromKey(e){return{id:e,group:"not-found"}}}));function s(){const n=h();xe(f,l,n.nodes,e=>{w(n.links,f,e),y(n.nodes,f,e),u(n,e)})}let c=re;return C(b,n=>{if(n){c();return}c=ae(()=>{s(),ie()})}),{config:l,getNodesAndLinks:h,didTick:s}}q(T.get,function(f){if(f=="2D"){const{getNodesAndLinks:u,didTick:l,config:b}=P(2,(s,c)=>{x(s.nodes,c),O(s.nodes,c)}),h=S.svg({width:F,height:A,viewBox:`${-800/2} ${-800/2} ${F} ${A}`,s_maxWidth:"100%",s_height:"auto",children(){M(()=>u().links,s=>S.g({stroke:"#999",strokeOpacity:.6,children(){S.line({x1:s.source.x.dSignal.get,y1:s.source.y.dSignal.get,x2:s.target.x.dSignal.get,y2:s.target.y.dSignal.get,strokeWidth:Math.sqrt(s.value.value)})}})),M(()=>u().nodes,s=>S.g({stroke:"#fff",strokeWidth:1.5,children(){S.circle({r:5,cx:s.x.dSignal.get,cy:s.y.dSignal.get,fill:v(s.value.group),...Q(c=>{const n=h.getBoundingClientRect(),e=n.left+n.width/2,i=n.top+n.height/2;s.x.f=c.pageX-e,s.y.f=c.pageY-i,b.alphaTarget=.3,l();const g=ce(d=>{d?(s.x.f=d.pageX-e,s.y.f=d.pageY-i):(s.x.f=void 0,s.y.f=void 0,b.alphaTarget=0,g())})})})}}))}})}else if(f=="3D"){const u=D(void 0),l=D(void 0);q(u.get,function(e){if(!e)return;const i=e.userData;ee.div({className:"text-white px-3 py-4 rounded-[8px]",s_position:"fixed",s_border:" 1px solid rgba(255,255,255,0.1)",s_background:"linear-gradient(135deg, #2c3e50, #4ca1af)",s_left(){var g;return(((g=l.get())==null?void 0:g.clientX)||0)+15+"px"},s_top(){var g;return(((g=l.get())==null?void 0:g.clientY)||0)+15+"px"},children(){te`${i.value.group}--${i.value.citing_patents_count||""}`}})});const b=Y("z"),{getNodesAndLinks:h,didTick:s,config:c}=P(3,(e,i)=>{x(e.nodes,i),O(e.nodes,i),b(e.nodes,i)}),n=ke(F,A);n.position.z=500,Se({camera:n,width:F,height:A,render(e){const{renderer:i}=Te.consume();e.background=new Le(16119802);const g=new De(16777215,.4);e.add(g);const d=new U(16777215,.8);d.position.set(5,10,7),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024,d.shadow.camera.near=.5,d.shadow.camera.far=50,e.add(d);const $=new U(16777215,.3);$.position.set(-5,5,5),e.add($);const E=ze(),Z=new Me(5,32,32);function B(o,a){o.x=a.x.d,o.y=a.y.d,o.z=a.z.d}const k=new Ce,z=new Fe,N=[],L=i.domElement;function G(o,a,t){const r=a.clientX-t.left,m=a.clientY-t.top;o.x=r/t.width*2-1,o.y=-(m/t.height*2-1)}function V(o,a){G(z,o,a),k.setFromCamera(z,n);const t=k.intersectObjects(N);if(t.length>0)return t[0].object}X(W(L,"pointermove",o=>{const a=L.getBoundingClientRect(),t=V(o,a);t?(u.set(t),l.set(o)):u.set(void 0)})),X(W(L,"pointerdown",o=>{const a=L.getBoundingClientRect(),t=V(o,a);if(t){E.enabled=!1;const r=t.userData;r.z.f=r.z.d,c.alphaTarget=.3,s(),de({onMove(m){G(z,m,a),k.setFromCamera(z,n);const _=k.ray.direction,R=k.ray.origin,j=(r.z.f-R.z)/_.z;r.x.f=R.x+_.x*j,r.y.f=R.y+_.y*j},onEnd(m){r.x.f=void 0,r.y.f=void 0,c.alphaTarget=0,E.enabled=!0}})}})),M(()=>h().nodes,o=>{const a=v(o.value.group),t=new Ae({color:a,specular:1118481,shininess:50,bumpMap:Ee(),bumpScale:.5,emissive:0,flatShading:!1}),r=new Be(Z,t);I(r),r.userData=o,N.push(r),X(()=>{ge(N,r)}),C(()=>{u.get()==r?t.emissive.setHex(3355443):t.emissive.set(a)}),C(()=>{B(r.position,o)})}),M(()=>h().links,o=>{const a=new Ne({color:0,transparent:!0,opacity:.3}),t=[];t.push(new H),t.push(new H);const r=new _e().setFromPoints(t),m=new Re(r,a);I(m),C(()=>{B(t[0],o.source),B(t[1],o.target),m.geometry=r.setFromPoints(t)})})}})}})}function Ee(){const p=new Uint8Array(16384);for(let w=0;w<64*64;w++){const y=w*4,x=Math.random()*255;p[y]=x,p[y+1]=x,p[y+2]=x,p[y+3]=255}const v=new Xe(p,64,64,Ye);return v.needsUpdate=!0,v}export{Ue as default};
