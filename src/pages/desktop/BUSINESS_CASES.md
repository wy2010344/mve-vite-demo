# 业务场景案例

这些是实际开发中最常见、最容易出错的复杂场景。

## 📝 复杂表单验证 (FormValidationApp)

**业务痛点：**

- 多字段联动验证（密码和确认密码）
- 异步验证（用户名重复检查）
- 验证时机控制（onChange vs onBlur）
- 错误信息实时展示
- 表单状态管理

**常见错误：**

- ❌ 每次输入都触发验证，性能差
- ❌ 异步验证没有防抖，请求过多
- ❌ 验证逻辑分散，难以维护
- ❌ 错误信息闪烁，用户体验差

**正确实现：**

- ✅ onBlur 时验证，避免频繁触发
- ✅ 异步验证带防抖和加载状态
- ✅ 集中管理验证规则
- ✅ touched 状态控制错误显示时机

## 📜 虚拟滚动列表 (VirtualScrollApp)

**业务痛点：**

- 大数据量列表渲染卡顿
- 动态高度难以计算
- 滚动位置不准确
- 快速滚动白屏

**常见错误：**

- ❌ 直接渲染所有数据，页面卡死
- ❌ 固定高度假设，实际高度不一致
- ❌ 没有缓冲区，滚动时闪烁
- ❌ 高度测量时机不对

**正确实现：**

- ✅ 只渲染可见区域 + 缓冲区
- ✅ 动态测量并缓存每项高度
- ✅ 使用占位元素撑开滚动条
- ✅ 滚动时实时计算可见范围

## 📋 拖拽排序 (DragDropApp)

**业务痛点：**

- 拖拽过程视觉反馈不清晰
- 跨列表拖拽状态混乱
- 动画过渡不流畅
- 拖拽边界处理复杂

**常见错误：**

- ❌ 直接修改 DOM，状态不同步
- ❌ 拖拽时没有视觉反馈
- ❌ 插入位置计算不准确
- ❌ 没有处理拖拽取消

**正确实现：**

- ✅ 状态驱动，单向数据流
- ✅ 拖拽时透明度和缩放反馈
- ✅ 实时计算插入位置
- ✅ 完整的拖拽生命周期管理

## ♾️ 无限滚动加载 (InfiniteScrollApp)

**业务痛点：**

- 滚动到底部判断不准确
- 重复加载数据
- 加载失败没有重试
- 空状态和错误状态处理

**常见错误：**

- ❌ 滚动事件没有节流，频繁触发
- ❌ 没有 loading 状态，重复请求
- ❌ 网络失败后无法恢复
- ❌ 没有"没有更多"的提示

**正确实现：**

- ✅ 距离底部阈值触发加载
- ✅ loading 状态防止重复请求
- ✅ 错误状态可重试
- ✅ 完整的状态管理（loading/error/empty/hasMore）

## ⏱️ 防抖与节流 (DebounceThrottleApp)

**业务痛点：**

- 搜索框每次输入都请求
- 滚动事件触发过于频繁
- resize 事件导致性能问题
- 不理解防抖和节流的区别

**常见错误：**

- ❌ 混淆防抖和节流的使用场景
- ❌ 没有清理定时器，内存泄漏
- ❌ 防抖时间设置不合理
- ❌ 节流实现不正确，仍然频繁触发

**正确实现：**

- ✅ 搜索用防抖（停止输入后执行）
- ✅ 滚动用节流（固定时间间隔执行）
- ✅ 正确清理定时器
- ✅ 可视化对比效果

## 💻 代码编辑器 (CodeEditorApp)

**业务痛点：**

- 代码执行安全性
- 语法高亮性能
- 字体大小动态调整
- 行号同步

**技术亮点：**

- Function 构造函数创建沙箱
- 自定义 console 捕获输出
- animateSignal 实现字体大小动画
- 行号与代码同步滚动

## 🎨 协作白板 (WhiteboardApp)

**业务痛点：**

- Canvas 绘图性能
- 路径平滑处理
- 多用户协作模拟
- 撤销重做功能

**技术亮点：**

- Canvas 路径绘制优化
- 实时光标位置同步
- 画笔/橡皮工具切换
- 路径数据结构设计

## 核心经验总结

### 1. 状态管理

- 单一数据源
- 状态驱动视图
- 避免直接操作 DOM

### 2. 性能优化

- 虚拟化长列表
- 防抖节流高频事件
- 懒加载和代码分割

### 3. 用户体验

- 加载状态反馈
- 错误处理和重试
- 空状态友好提示

### 4. 边界处理

- 网络失败
- 数据为空
- 极端情况测试
